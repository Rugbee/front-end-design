Backbone.sync=function(h,d,c){var g={create:gadgets.io.MethodType.POST,update:gadgets.io.MethodType.PUT,"delete":gadgets.io.MethodType.DELETE,read:gadgets.io.MethodType.GET};var a=function(i){if(!(i&&i.url)){throw new Error("A 'url' property or function must be specified")}var j=_.isFunction(i.url)?i.url():i.url;return eventsBaseUrl+j};var f={};f[gadgets.io.RequestParameters.METHOD]=g[h];f[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.JSON;f[gadgets.io.RequestParameters.HEADERS]={Accept:"application/json"};f[gadgets.io.RequestParameters.AUTHORIZATION]=gadgets.io.AuthorizationType.SIGNED;if(h==="create"||h==="update"){f[gadgets.io.RequestParameters.HEADERS]["Content-Type"]="application/json";if(d instanceof Backbone.Model){f[gadgets.io.RequestParameters.POST_DATA]=encode_utf8(JSON.stringify(d.toJSON()))}else{f[gadgets.io.RequestParameters.POST_DATA]=encode_utf8(JSON.stringify(d))}}var e=c.success;var b=c.error;gadgets.io.makeRequest(a(d),function(i){if(!_.isEmpty(i.errors)){if(b&&(a(d)!=eventsBaseUrl+"/events/error")){if(i.rc==504){pageView.showErrorPage()}else{if(i.rc<500){Reporter.error({type:i.rc,error_url:a(d),method:g[h]})}b(i.errors)}}}else{var j=i.data;if(200<=j.status&&j.status<300){if(e){e(j.body,j.status)}}else{if(b){b(j.body,j.status)}}}},f)};var OS={viewer:null,resize:function(){try{gadgets.window.adjustHeight($("body").height())}catch(a){}},getViewer:function(){OS.viewer=opensocial.data.getDataContext().getDataSet("viewer")},navigateToOwnerlessCanvasView:function(c){var b=new gadgets.views.View("canvas");var a=linkedin.IdSpec.PersonId.IMPLICIT;gadgets.views.requestNavigateTo(b,c,a)},makeRequest:function(a,d){var c={};var b=c[gadgets.io.RequestParameters.HEADERS]||{};b.accept="text/json";c[gadgets.io.RequestParameters.CONTENT_TYPE]=c[gadgets.io.RequestParameters.CONTENT_TYPE]||gadgets.io.ContentType.JSON;c[gadgets.io.RequestParameters.AUTHORIZATION]=gadgets.io.AuthorizationType.SIGNED;c[gadgets.io.RequestParameters.METHOD]=gadgets.io.MethodType.GET;gadgets.io.makeRequest(a,d,c)}};try{OS.getViewer()}catch(err){}function encode_utf8(a){return unescape(encodeURIComponent(a))}function decode_utf8(a){return decodeURIComponent(escape(a))}function padzero(a){return a<10?"0"+a:a}function pad2zeros(a){if(a<100){a="0"+a}if(a<10){a="0"+a}return a}function toISOString(a){return a.getUTCFullYear()+"-"+padzero(a.getUTCMonth()+1)+"-"+padzero(a.getUTCDate())+"T"+padzero(a.getUTCHours())+":"+padzero(a.getUTCMinutes())+":"+padzero(a.getUTCSeconds())+"."+pad2zeros(a.getUTCMilliseconds())+"Z"}var LargeSpinnerOpts={lines:8,length:0,width:20,radius:24,color:"#000",speed:1.4,trail:54,shadow:false};var SmallSpinnerOpts={lines:8,length:0,width:9,radius:11,color:"#000",speed:1.4,trail:54,shadow:false};var VerySmallSpinnerOpts={lines:8,length:0,width:4,radius:4,color:"#000",speed:1.4,trail:54,shadow:false};var Share={shareOnLinkedIn:function(b,e,a,d){if(!(d&&d.length>0)){d=" "}else{d=d.substring(0,300).split(" ").slice(0,-1).join(" ")}var c="http://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(a+"?trk=lishare-events-"+b+"-detail")+"&summary="+encodeURIComponent(d)+"&title="+encodeURIComponent(e)+"&source="+encodeURIComponent("LinkedIn Events");this.openShareWindow(c,"LinkedIn")},shareOnFacebook:function(b,d,a){var c="http://www.facebook.com/sharer.php?u="+encodeURIComponent(a+"?trk=facebook-events-"+b+"-detail")+"&t="+encodeURIComponent(d);this.openShareWindow(c,"Facebook")},shareOnTwitter:function(a,c,d){if(c.length>=100){c=c.substring(0,97)+"..."}var b="http://twitter.com/share?text="+encodeURIComponent("LinkedIn Events: "+c+" "+d)+'&url=""';this.openShareWindow(b,"Twitter")},openShareWindow:function(b,a){opts={width:650,height:300,status:0,toolbar:0,location:0,menubar:0,directories:0,scrollbars:0};var d=[];for(var c in opts){d.push(c+"="+opts[c])}return window.open(b,a,d.join())}};var Tracker={trackClick:function(b,a){Tracker.trackPage(b,a,"AJAX")},trackPage:function(f,c,b){try{if(Tracker.allowTracking()){var a=$("<img>");var d="&pageType=";d+=(b)?b:"full_page";var g="https://www.linkedin.com/analytics/noauthtracker?type=leo.pageTracking"+d+"&pageKey="+f;if(c){g+="&trackingInfo="+c}a.attr("src",g);$("#tracker").append(a)}}catch(e){}},allowTracking:function(){if(eventsBaseUrl==="http://events2.linkedinlabs.com"||eventsBaseUrl==="http://events.linkedin.com"||eventsBaseUrl==="http://events-cn2.linkedinlabs.com"||eventsBaseUrl==="http://events2stg.linkedinlabs.com"){return true}else{return false}}};var Validator={validateBaseUrl:function(){return(eventsBaseUrl!=="http://localhost:3000/")}};var pageView,landingPageView,searchPageView,eventDetailPageView,banner,errorPageView;var Search={};var Sap={};var Reporter={error:function(a){a.url="/events/error";Backbone.sync("create",a,{success:function(){},error:function(){}})}};var AttendeeSearch=Backbone.Model.extend({originalFacets:null,currentFacets:null,userIdsSortedBy:{},currentSelection:{sort:"date",userIds:[],page:1,totalPages:1,perPage:10},initialize:function(){_.bindAll(this,"changeUsers","changeSort","updateSelection","fetchUsers","fetchPage","setFacetsAndFetch","setPageAndFetch","showSpinner")},extractOtherProperties:function(a){this.originalFacets=_.union(a.rsvps.facets_info.facets,[]);this.currentFacets=_.union(a.rsvps.facets_info.facets,[]);this.userIdsSortedBy=a.rsvps.facets_info.user_ids_sorted_by;this.currentSelection.userIds=a.rsvps.facets_info.user_ids_sorted_by.date;this.currentSelection.totalPages=this.currentSelection.userIds.length/this.currentSelection.perPage;this.updateSelection()},changeUsers:function(b){var c=null;for(var a in this.userIdsSortedBy){if(a==this.currentSelection.sort){c=this.userIdsSortedBy[a];break}}if(b&&b.length>0){this.currentSelection.userIds=_.intersection(c,b)}else{this.currentSelection.userIds=c}this.currentSelection.page=1;this.currentSelection.totalPages=Math.ceil(this.currentSelection.userIds.length/this.currentSelection.perPage);this.updateSelection();this.fetchUsers()},changeSort:function(c){this.currentSelection.sort=c;var d=null;var b=this.currentSelection.userIds;for(var a in this.userIdsSortedBy){if(a==this.currentSelection.sort){d=this.userIdsSortedBy[a];break}}if(b&&b.length>0){this.currentSelection.userIds=_.intersection(d,b)}else{this.currentSelection.userIds=d}this.updateSelection();this.fetchUsers()},updateSelection:function(){var b=this.currentSelection;var c=(b.page-1)*b.perPage;var a=c+b.userIds.slice(c,c+b.perPage).length;this.set({total:this.currentSelection.userIds.length,start:c,end:a,range:(c+1)+"-"+a,hasPrevious:b.page>1,hasNext:b.page<b.totalPages})},fetchPage:function(a){this.currentSelection.page=a;this.updateSelection();this.fetchUsers()},fetchUsers:function(){var a=this.currentSelection;this.get("usersCollection").setUserIdsAndFetch(a.userIds.slice(this.get("start"),this.get("end")))},setFacetsAndFetch:function(d){this.showSpinner();this.start=0;var a=this.originalFacets;var e=[];_.each(a,function(i){var f={type:i.type};f.items=[];var h=[];for(var g in d){if(g!=i.type){if(h.length){h=_.intersection(h,d[g])}else{h=d[g]}}}if(h.length){_.each(i.items,function(l){var k=_.intersection(l.user_ids,h);if(k!=null&&k.length>0){var j={value:l.value,user_ids:_.union(l.user_ids,[]),count:k.length};f.items.push(j)}})}else{_.each(i.items,function(k){var j={value:k.value};j.user_ids=_.union(k.user_ids,[]);j.count=j.user_ids.length;f.items.push(j)})}e.push(f)});this.currentFacets=e;var c=[];for(var b in d){if(c.length){c=_.intersection(c,d[b])}else{c=d[b]}}this.changeUsers(c)},setPageAndFetch:function(a){this.fetchPage(a);this.showSpinner()},showSpinner:function(){var a=new Spinner(LargeSpinnerOpts).spin();$("#search-results-spinner").css({left:Math.ceil($(window).width()/2)}).html(a.el);$(".right-section-large").css({opacity:0.3})}});var Event=Backbone.Model.extend({rosterPage:null,viewer:null,fields:"",include:"",url:function(){if(this.isNew()){return"/events"}return"/events/"+this.get("id")+"?include="+this.include+"&fields="+this.fields},initialize:function(){this.rosterPage=new RosterPage(this.get("rsvps"));this.rosterPage.eventId=this.get("id");_.bindAll(this,"updateLogo","updateRosterPage","updateUpdatesPage","updateViewer");this.bind("change:rsvps",this.updateRosterPage);this.updatesPage=new UpdatesPage(this.get("updates"));this.updatesPage.eventId=this.get("id");_.bindAll(this,"updateUpdatesPage");this.bind("change:updates",this.updateUpdatesPage);this.viewer=new EventViewer(this.get("viewer_rsvp"));this.viewer.eventId=this.get("id");_.bindAll(this,"updateViewer");this.bind("change:viewer_rsvp",this.updateViewer);if(!this.get("logo_url")){this.set({logo_url:eventsAssetUrl+"/images/default_event_logo.png"})}this.bind("change:logo_url",this.updateLogo)},updateLogo:function(){if(!this.get("logo_url")){this.set({logo_url:eventsAssetUrl+"/images/default_event_logo.png"})}},updateRosterPage:function(){this.rosterPage.set(this.get("rsvps"))},updateUpdatesPage:function(){this.updatesPage.set(this.get("updates"))},updateViewer:function(){this.viewer.set(this.get("viewer_rsvp"))}});var EventSearch=Backbone.Model.extend({query:"",facets:null,start:null,includePast:false,resetFacets:false,pastCount:0,sortBy:"date",url:function(){var a="/events?q="+encodeURIComponent(this.query)+"&include=viewer_rsvp,rsvps(role:attendee,sort:network,count:3)&fields=title,description,logo_url,formatted_date,venue,attendee_count";if(this.facets!=null){a+="&facets="+encodeURIComponent(JSON.stringify(this.facets))}if(this.start!==null){a+="&start="+this.start}a+="&include_past="+this.includePast;a+="&sort_by="+this.sortBy;return a},initialize:function(){_.bindAll(this,"setQueryAndFetch","setFacetsAndFetch","setPageAndFetch","showSpinner","setPastEventFlagAndFetch","fetchResults","setSortByAndFetch")},setSortByAndFetch:function(a){this.showSpinner();this.sortBy=a;this.fetchResults()},setQueryAndFetch:function(a){this.query=a;this.start=0;this.pastCount=0;this.includePast=false;this.resetFacets=true;this.sortBy="date";this.showSpinner();this.fetchResults()},setFacetsAndFetch:function(a){this.facets=a;this.start=0;this.resetFacets=false;this.fetchResults();this.showSpinner()},fetchResults:function(){var a=this;this.fetch({success:function(){if(a.get("items").length==0&&a.includePast==false&&a.pastCount==0){a.pastCount++;a.setPastEventFlagAndFetch(true)}else{a.view.renderResults()}}})},setPageAndFetch:function(a){var b=(a-1)*10;this.start=b;this.resetFacets=false;this.fetchResults();this.showSpinner()},showSpinner:function(){var a=new Spinner(LargeSpinnerOpts).spin();$("#search-results-spinner").css({left:Math.ceil($(window).width()/2)}).html(a.el);$(".right-section-large").css({opacity:0.3})},setPastEventFlagAndFetch:function(a){this.includePast=a;this.start=0;this.fetchResults();this.showSpinner()}});var EventSummary=Backbone.Model.extend({initialize:function(){if(this.get("description")){var b=this.get("description").substring(0,300).split(" ").slice(0,-1).join(" ");this.set({description:b+" "})}if(!this.get("logo_url")){this.set({logo_url:eventsAssetUrl+"/images/default_event_logo.png"})}if(this.has("viewer_rsvp")){var a=this.get("viewer_rsvp");if(a.role==="none"){this.set({statusNone:true})}if(a.role==="attendee"){this.set({statusThere:true});this.set({message:"Attending"})}if(a.role==="follower"){this.set({statusThere:true});this.set({message:"Following"})}}if(this.has("venue")){if(this.get("venue").name!==null&&this.get("venue").name.length>1){this.set({namePresent:true})}if(this.get("venue").city!==null){this.set({cityPresent:true})}}}});var EventViewer=Backbone.Model.extend({});var FacetItem=Backbone.Model.extend({initialize:function(){if(!(typeof this.get("currentCount")==="undefined")){}else{this.set({currentCount:this.get("count")})}if(this.get("selected")&&this.get("selected")>0){}else{this.set({selected:0})}}});var RosterPage=Backbone.Model.extend({eventId:null,pageSize:10,defaults:{start:0,sort:"date",role:"attendee"},url:function(){return"/events/"+this.eventId+"/rsvps?start="+this.get("start")+"&count="+this.pageSize+"&sort="+this.get("sort")+"&role="+this.get("role")},initialize:function(){var b=_.map(this.get("items"),function(c){return c.user});var a=new UsersCollection(b);this.set({attendees:a});_.bindAll(this,"updateAttendeesCollection");this.bind("change:items",this.updateAttendeesCollection)},updateAttendeesCollection:function(){var a=_.map(this.get("items"),function(b){return b.user});this.get("attendees").reset(a)}});var Update=Backbone.Model.extend({user:null,initialize:function(){this.user=new User(this.get("user"));this.set({isRsvp:this.get("source").type=="Rsvp"});_.bindAll(this,"updateUser");if(!this.get("isRsvp")){this.set({isNotRsvp:true})}this.bind("change:user",this.updateUser)},updateUser:function(){this.user.set(this.get("user"))}});var UpdatesPage=Backbone.Model.extend({updates:null,start:null,url:function(){var a="/events/"+this.eventId+"/updates";var b=[];if(this.start){b.push("before="+this.start)}if(this.has("type")){b.push("type="+this.get("type"))}if(b.length){a+="?"+b.join("&")}return a},initialize:function(){this.updates=new UpdatesCollection(this.get("items"));_.bindAll(this,"updateUpdatesCollection");this.bind("change:items",this.updateUpdatesCollection)},updateUpdatesCollection:function(){this.updates.reset(this.get("items"))}});var User=Backbone.Model.extend({});var EymlCollection=Backbone.Collection.extend({model:EventSummary,hasMore:false,url:function(){return"/users/"+OS.viewer.id+"/recommended_events?fields=title,logo_url,formatted_date,venue&include=rsvps(role:attendee,sort:network,count:6)&start=0&count=5"},parse:function(a){this.industry_name=a.industry_name;this.industry_id=a.industry_id;return a.items}});var FacetItemsCollection=Backbone.Collection.extend({type:null,model:FacetItem,max:0,items:null,visibleItems:null,selectedItems:null,selectedUsers:null,parent:null,page:1,PAGE_SIZE:6,hasMore:false,pxWidth:48,initialize:function(b,a){this.type=a.type;this.parent=a.parent;this.items=a.items;this.pxWidth=a.pxWidth;_.bindAll(this,"calculatePercentile","calculateMax","sortDesc","resetItems","selectFacetItemsForCurrentPage","selectItem","deselectItem","clearVisibleItems","selectFacetItemsBasedOnSelectedUsers","selectUsers","showSelected","showMore");this.bind("add",this.calculateMax);this.resetItems()},calculatePercentile:function(){var b=this.pxWidth;var a=this;_.each(this.models,function(c){if(c.get("currentCount")==0){c.set({perc:10})}else{c.set({perc:Math.max(Math.round(c.get("currentCount")/a.max*b),10)})}})},calculateMax:function(a){if(a.get("currentCount")>this.max){this.max=a.get("currentCount")}this.calculatePercentile()},selectItem:function(b){if(this.selectedItems==null){this.selectedItems=[]}var a={value:b.get("value"),count:b.get("count"),user_ids:b.get("user_ids")};this.selectedItems.push(a);this.showSelected();this.parent.updateFacetsBasedOnSelectedFacet(this.type)},deselectItem:function(d){var c={count:d.get("count"),user_ids:d.get("user_ids"),value:d.get("value")};var b=-1;for(var a=0;a<this.selectedItems.length;a++){if(this.selectedItems[a].value==c.value){b=a;break}}if(b>-1){this.selectedItems.splice(b,1)}this.showSelected();if(this.selectedItems&&this.selectedItems.length>0){this.parent.updateFacetsBasedOnSelectedFacet(this.type)}else{this.parent.updateFacetsBasedOnDeSelectedFacet(this.type)}},sortDesc:function(){this.visibleItems=_.sortBy(this.visibleItems,function(a){return a.currentCount*-1})},clearVisibleItems:function(){this.visibleItems=[];this.models=[];this.page=1;this.max=0},resetItems:function(){this.clearVisibleItems();this.visibleItems=this.items;_.each(this.visibleItems,function(c){c.currentCount=c.count});var b=this;var a=[];if(b.selectedItems&&b.selectedItems.length>0){_.each(b.selectedItems,function(c){_.each(b.visibleItems,function(d){if(d.value==c.value){d.selected=1}})});_.each(b.visibleItems,function(c){if(!c.selected){c.selected=2}})}else{_.each(b.visibleItems,function(c){c.selected=0})}this.sortDesc();this.page=1;this.max=0;this.selectFacetItemsForCurrentPage()},selectFacetItemsForCurrentPage:function(){var a=(this.page-1)*this.PAGE_SIZE;var b=a+this.PAGE_SIZE;this.add(this.visibleItems.slice(a,b));if(this.models.length<this.visibleItems.length){this.hasMore=true}else{this.hasMore=false}},selectFacetItemsBasedOnSelectedUsers:function(c){this.clearVisibleItems();var b=this;var a=[];_.each(this.selectedItems,function(f){var e=_.intersection(c,f.user_ids);var d={};d.user_ids=f.user_ids;d.value=f.value;d.selected=1;if(e.length>0){d.currentCount=e.length}else{d.currentCount=0}a.push(d.value);b.visibleItems.push(d)});_.each(this.items,function(f){if(_.include(a,f.value)){}else{var e=_.intersection(c,f.user_ids);if(e.length>0){var d=_.clone(f);d.user_ids=f.user_ids;d.currentCount=e.length;b.visibleItems.push(d)}}});this.sortDesc(this.visibleItems);this.selectFacetItemsForCurrentPage()},selectUsers:function(){var a=this;a.selectedUsers=[];_.each(this.selectedItems,function(b){a.selectedUsers=_.union(a.selectedUsers,b.user_ids)});return a.selectedUsers},showSelected:function(){var a=this;if(this.selectedItems.length>0){_.each(this.models,function(d){var c={value:d.get("value"),count:d.get("count"),user_ids:d.get("user_ids")};var b=false;_.each(a.selectedItems,function(e){if(c.value==e.value){d.set({selected:1});b=true}});if(!b){d.set({selected:2})}})}else{_.each(this.models,function(b){b.set({selected:0})})}},showMore:function(){this.page++;this.selectFacetItemsForCurrentPage()}});var LinkedinHomeEymlCollection=Backbone.Collection.extend({model:EventSummary,hasMore:false,url:function(){return"/users/"+OS.viewer.id+"/recommended_events?fields=title,logo_url,formatted_date,venue&include=rsvps(role:attendee,sort:network,count:2)&start=0&count=3"},parse:function(a){this.industry_name=a.industry_name;this.industry_id=a.industry_id;return a.items}});var MatchmakerCollection=Backbone.Collection.extend({model:User,eventId:null,fetchingMore:false,totalDeleted:0,ready:false,usedCids:[],unusedCids:[],total:null,nextStart:null,iAmDone:false,initialize:function(b){var a=b.event;this.eventId=a.get("id");this.reset(this.parse(a.get("matches")));_.bindAll(this,"checkHealth","fetch","updateState","getOne","parse","initializeStateVariables","updateUnusedBucket");this.initializeStateVariables()},url:function(){return"/events/"+this.eventId+"/matches?count=5&start="+this.nextStart},parse:function(a){this.total=a.total;this.nextStart=a.start+a.count;return a.items},checkHealth:function(){return this.unusedCids.length<=2},initializeStateVariables:function(){this.currentTotalCount=this.length;var a=this;_.each(this.models,function(b){a.unusedCids.push(b.cid)})},updateState:function(){if(this.checkHealth()&&!this.fetchingMore&&this.nextStart<this.total){this.fetchingMore=true;var a=this;this.fetch({add:true,success:function(b){a.currentTotalCount=a.models.length;a.nextStart=a.nextStart+5;a.updateUnusedBucket()}})}else{this.fetchingMore=false;if(this.nextStart<this.total){this.iAmDone=true}}},updateUnusedBucket:function(){var b=[];var a=this;_.each(this.models,function(c){b.push(c.cid)});this.unusedCids=_.union(_.difference(b,this.usedCids),a.unusedCids)},getOne:function(){var a=this.unusedCids.pop();var b=this.getByCid(a);this.usedCids.push(a);return b}});var MyEventsCollection=Backbone.Collection.extend({model:EventSummary,hasMore:false,nextStart:0,url:function(){return"/events/mine?fields=title,logo_url,formatted_date,venue,owner_id,recent_update_count,attendee_count&include=viewer_rsvp&count=4&start="+this.nextStart},parse:function(a){this.nextStart=a.start+a.count;this.hasMore=this.nextStart<a.total;return a.items},fetchMore:function(){this.fetch({add:true})}});Search.FacetItemsCollection=Backbone.Collection.extend({type:null,model:FacetItem,max:0,items:null,visibleItems:null,selectedItems:null,selectedUsers:null,parent:null,page:1,PAGE_SIZE:6,hasMore:false,pxWidth:48,initialize:function(b,a){this.type=a.type;this.parent=a.parent;this.items=a.items;this.pxWidth=a.pxWidth;_.bindAll(this,"calculatePercentile","calculateMax","sortDesc","selectItem","deselectItem","setPageBasedOnLowestSelectedItem","resetItems","selectFacetItemsForCurrentPage","showSelected","showMore");this.bind("add",this.calculateMax);if(a.preSelectedIds){this.resetItems(false,a.preSelectedIds)}else{this.resetItems(false)}},calculatePercentile:function(){var b=this.pxWidth;var a=this;_.each(this.models,function(c){if(c.get("currentCount")==0){c.set({perc:10})}else{c.set({perc:Math.max(Math.round(c.get("currentCount")/a.max*b),10)})}})},calculateMax:function(a){if(a.get("currentCount")>this.max){this.max=a.get("currentCount")}this.calculatePercentile()},sortDesc:function(){this.visibleItems=_.sortBy(this.visibleItems,function(a){return a.currentCount*-1})},selectItem:function(b){if(this.selectedItems==null){this.selectedItems=[]}var a={value:b.get("value"),count:b.get("count"),id:b.get("id")};this.selectedItems.push(a);this.showSelected();this.parent.updateFacetsSelected()},deselectItem:function(d){var c={value:d.get("value"),count:d.get("count"),id:d.get("id")};var b=-1;for(var a=0;a<this.selectedItems.length;a++){if(this.selectedItems[a].value==c.value){b=a;break}}if(b>-1){this.selectedItems.splice(b,1)}this.showSelected();this.parent.updateFacetsSelected()},setPageBasedOnLowestSelectedItem:function(){var b=-1;for(var a=this.visibleItems.length-1;a>=0;a--){if(this.visibleItems[a].selected==1){b=a+1;break}}if(b>-1){this.page=Math.ceil(b/this.PAGE_SIZE)}},resetItems:function(d,c){this.visibleItems=[];this.max=0;if(d){this.page=1;this.selectedItems=[]}this.visibleItems=this.items;_.each(this.visibleItems,function(e){e.currentCount=e.count});this.sortDesc();var b=this;var a=[];if(b.selectedItems&&b.selectedItems.length>0){_.each(b.selectedItems,function(e){_.each(b.visibleItems,function(f){if(f.value==e.value){f.selected=1}})});_.each(b.visibleItems,function(e){if(!e.selected){e.selected=2}})}else{if(c){if(b.selectedItems==null){b.selectedItems=[]}_.each(b.visibleItems,function(f){if(_.include(c,f.id)){f.selected=1;var e={value:f.value,count:f.count,id:f.id};b.selectedItems.push(e)}else{f.selected=2}})}else{_.each(b.visibleItems,function(e){e.selected=0})}}this.setPageBasedOnLowestSelectedItem();this.selectFacetItemsForCurrentPage()},selectFacetItemsForCurrentPage:function(){this.reset();var a=0;var b=a+this.page*this.PAGE_SIZE;this.add(this.visibleItems.slice(a,b));if(this.models.length<this.visibleItems.length){this.hasMore=true}else{this.hasMore=false}},showSelected:function(){var a=this;if(this.selectedItems.length>0){_.each(this.models,function(d){var c={value:d.get("value"),count:d.get("count"),user_ids:d.get("user_ids")};var b=false;_.each(a.selectedItems,function(e){if(c.value==e.value){d.set({selected:1});b=true}});if(!b){d.set({selected:2})}})}else{_.each(this.models,function(b){b.set({selected:0})})}},showMore:function(){this.page++;this.selectFacetItemsForCurrentPage();return this.hasMore}});var SearchResultsCollection=Backbone.Collection.extend({});Sap.FacetItemsCollection=Backbone.Collection.extend({type:null,model:FacetItem,max:0,items:null,visibleItems:null,selectedItems:null,selectedUsers:null,parent:null,page:1,PAGE_SIZE:6,hasMore:false,pxWidth:48,initialize:function(b,a){this.type=a.type;this.parent=a.parent;this.items=a.items;this.pxWidth=a.pxWidth;_.bindAll(this,"calculatePercentile","calculateMax","sortDesc","selectItem","deselectItem","setPageBasedOnLowestSelectedItem","resetItems","selectFacetItemsForCurrentPage","showSelected","showMore");this.bind("add",this.calculateMax);this.resetItems()},calculatePercentile:function(){var b=this.pxWidth;var a=this;_.each(this.models,function(c){if(c.get("currentCount")==0){c.set({perc:10})}else{c.set({perc:Math.max(Math.round(c.get("currentCount")/a.max*b),10)})}})},calculateMax:function(a){if(a.get("currentCount")>this.max){this.max=a.get("currentCount")}this.calculatePercentile()},sortDesc:function(){this.visibleItems=_.sortBy(this.visibleItems,function(a){return a.currentCount*-1})},selectItem:function(b){if(this.selectedItems==null){this.selectedItems=[]}var a={value:b.get("value"),count:b.get("count"),user_ids:b.get("user_ids")};this.selectedItems.push(a);this.showSelected();this.parent.updateFacetsSelected()},deselectItem:function(d){var c={value:d.get("value"),count:d.get("count"),user_ids:d.get("user_ids")};var b=-1;for(var a=0;a<this.selectedItems.length;a++){if(this.selectedItems[a].value==c.value){b=a;break}}if(b>-1){this.selectedItems.splice(b,1)}this.showSelected();this.parent.updateFacetsSelected()},setPageBasedOnLowestSelectedItem:function(){var b=-1;for(var a=this.visibleItems.length-1;a>=0;a--){if(this.visibleItems[a].selected==1){b=a+1;break}}if(b>-1){this.page=Math.ceil(b/this.PAGE_SIZE)}},resetItems:function(){this.visibleItems=[];this.max=0;this.visibleItems=this.items;_.each(this.visibleItems,function(c){c.currentCount=c.count});this.sortDesc();var b=this;var a=[];if(b.selectedItems&&b.selectedItems.length>0){_.each(b.selectedItems,function(c){_.each(b.visibleItems,function(d){if(d.value==c.value){d.selected=1}})});_.each(b.visibleItems,function(c){if(!c.selected){c.selected=2}})}else{_.each(b.visibleItems,function(c){c.selected=0})}this.setPageBasedOnLowestSelectedItem();this.selectFacetItemsForCurrentPage()},selectFacetItemsForCurrentPage:function(){this.reset();var a=0;var b=a+this.page*this.PAGE_SIZE;this.add(this.visibleItems.slice(a,b));if(this.models.length<this.visibleItems.length){this.hasMore=true}else{this.hasMore=false}},showSelected:function(){var a=this;if(this.selectedItems.length>0){_.each(this.models,function(d){var c={value:d.get("value"),count:d.get("count"),user_ids:d.get("user_ids")};var b=false;_.each(a.selectedItems,function(e){if(c.value==e.value){d.set({selected:1});b=true}});if(!b){d.set({selected:2})}})}else{_.each(this.models,function(b){b.set({selected:0})})}},showMore:function(){this.page++;this.selectFacetItemsForCurrentPage();return this.hasMore}});var UpdatesCollection=Backbone.Collection.extend({model:Update,eventId:null,url:function(){return"/events/"+eventId+"/updates"},initialize:function(a){if(a&&a.eventId){this.eventId=a.eventId}}});var UsersCollection=Backbone.Collection.extend({model:User,userIds:null,url:function(){return"/users?ids="+encodeURIComponent(this.userIds)},initialize:function(a){this.el=$("#see-all-people-page");_.bindAll(this,"setUserIdsAndFetch")},setUserIdsAndFetch:function(a){this.userIds=a.toString();this.fetch()}});var YourEventsCollection=Backbone.Collection.extend({model:EventSummary,hasMore:false,nextStart:0,url:function(){return"/events/yours?fields=title,logo_url,formatted_date,venue,owner_id,recent_update_count,attendee_count&include=viewer_rsvp&count=4&start="+this.nextStart},parse:function(a){this.nextStart=a.start+a.count;this.hasMore=this.nextStart<a.total;return a.items},fetchMore:function(){this.fetch({add:true})}});var ShowMoreListView=Backbone.View.extend({events:{"click .show-more":"showMoreWasClicked"},initialize:function(){this.delegateEvents();_.bindAll(this,"appendItemToList","collectionWasReset","itemWasAdded","showMoreWasClicked");this.render()},render:function(){var a=$(this.el);$(this.el).html('<div class="spin" style="height:150px;margin-top:100px;text-align:center">&nbsp;</div>');var b=new Spinner(SmallSpinnerOpts).spin();a.find(".spin").append(b.el);return this},collectionWasReset:function(){if(this.collection.length>0){$(this.el).html(this.template());this.collection.each(this.appendItemToList);this.toggleShowMore()}else{$(this.el).html(this.emptyListTemplate());this.emptyListRendered()}if($.browser.msie&&$.browser.version.slice(0,1)=="8"){if($("#eyml-module").height()>$("#my-events-module").height()){$("#landing-page").height($("#eyml-module").height()+$("#search-box-container").height()+70)}else{$("#landing-page").height($("#my-events-module").height()+$("#create-banner").height()+70)}}OS.resize();return this},emptyListRendered:function(){},itemWasAdded:function(a){this.appendItemToList(a);this.toggleShowMore()},showMoreWasClicked:function(){this.collection.fetchMore();return false},installCollectionBindings:function(){this.collection.bind("reset",this.collectionWasReset);this.collection.bind("add",this.itemWasAdded)},appendItemToList:function(b){var a=new this.itemViewClass({model:b}).render().el;this.$(".list").append(a)},toggleShowMore:function(){this.$(".show-more").toggle(this.collection.hasMore);OS.resize()}});var EventItemView=Backbone.View.extend({className:"item",template:null,events:{"click .nav-to-detail":"navigateToEventDetailPage","click .nav-to-sap":"navigateToEventSapPage"},initialize:function(){_.bindAll(this,"navigateToEventDetailPage","navigateToEventSapPage");this.delegateEvents()},render:function(){$(this.el).html(this.template(this.model.toJSON()));return this},navigateToEventDetailPage:function(a){if(this.template==JST.myEvent){Tracker.trackClick("events_home_yourevents_jsbeacon",this.model.get("id"));Router.send(Router.routes.EventDetailPage,{event:this.model.get("id")})}else{if(this.template==JST.eymlItem){Tracker.trackClick("events_home_eymbii_jsbeacon",this.model.get("id"));Router.send(Router.routes.EventDetailPage,{event:this.model.get("id"),referrer:"eymbii"})}else{if(this.template==JST.profilePage){Tracker.trackClick("events_profile_yourevents_jsbeacon",this.model.get("id"));Router.send(Router.routes.EventDetailPage,{event:this.model.get("id"),referrer:"profile"})}else{Router.send(Router.routes.EventDetailPage,{event:this.model.get("id")})}}}return false},navigateToEventSapPage:function(){if(this.template==JST.myEvent){Tracker.trackClick("events_home_yoursap_jsbeacon",this.model.get("id"))}else{if(this.template==JST.eymlItem){Tracker.trackClick("events_home_eymbiisap_jsbeacon",this.model.get("id"))}}Router.send(Router.routes.SeeAllPeoplePage,{event:this.model.get("id")});return false}});var PageView=Backbone.View.extend({template:JST.opensocialContainer,initialize:function(){this.el=$("#opensocial-container");this.render();_.bindAll(this,"render","showSpinner","hideSpinner","showErrorPage")},render:function(){$("body").append(this.template());return this},showSpinner:function(){var a=new Spinner(LargeSpinnerOpts).spin();$("#app-spinner").html(a.el)},hideSpinner:function(){$("#app-spinner").html("")},showErrorPage:function(a){new StaticErrorPageView(a)}});var ASearchResultsView=Backbone.View.extend({searchResultsCollection:null,searchResultsContainerElm:null,events:{"click #create-link":"navigateToCreateIPage"},initialize:function(a){this.el=$("#search-results-container");this.searchResultsContainerElm=a.container;this.searchResultsCollection=new SearchResultsCollection();this.searchResultsCollection.model=a.type;_.bindAll(this,"pasteResults","showSpinner","hideSpinner","showResults","navigateToCreateIPage");this.delegateEvents();this.searchResultsCollection.bind("reset",this.pasteResults);OS.resize()},showSpinner:function(){var a=new Spinner(LargeSpinnerOpts).spin();$(this.el).parent().find("#search-results-spinner").html(a.el)},hideSpinner:function(){$("#search-results-spinner").html("");this.searchResultsContainerElm.css({opacity:1})},showResults:function(a){if(a instanceof Backbone.Collection){this.searchResultsCollection.reset(a.models)}else{if(a instanceof Array){this.searchResultsCollection.reset(a)}}},navigateToCreateIPage:function(){Router.send(Router.routes.CreateEventStep1Page,{});return false}});var BannerView=Backbone.View.extend({template:JST.banner,events:{"click .dismiss":"removeBanner"},initialize:function(){this.el=$("#banner");_.bindAll(this,"render","publish","removeBanner");this.delegateEvents();this.render()},render:function(a){$(this.el).html(this.template());return this},publish:function(a,b){$(this.el).show();$(this.el).find("#"+a).css("display","block");$(this.el).find("#"+a).find("p").html(b);OS.resize()},removeBanner:function(){$(this.el).fadeOut("slow");$(this.el).find("p").html("");OS.resize();return false}});var BreadCrumbView=Backbone.View.extend({initialize:function(a){this.el=$("#brd-crumb");_.bindAll(this,"render","takeMeHome");this.render(a)},render:function(c){var b=function(e){if(e.data.msg.page==Router.routes.HomePage){Tracker.trackClick("events_bc_home_jsbeacon",d.attr("href"))}Router.send(e.data.msg.page,e.data.msg.params);return false};var a=_.map(c.list,function(f){var g=f.title.substring(0,75);if(f.link){var e=$('<a href="#" class="crumb">'+_.escape(g)+"</a>");e.click({msg:f},b);return e}else{return $("<span>"+_.escape(g)+"<span>")}});var d=$(this.el);d.append(_.first(a));_.each(_.rest(a),function(e){d.append("<span> &raquo; </span>").append(e)});return this},takeMeHome:function(){Router.send(Router.routes.HomePage,{})}});var breadCrumbView;var CreateBannerView=Backbone.View.extend({template:JST.createBanner,searchBoxView:null,events:{"click #create-event":"navigateToCreatePage"},initialize:function(){this.el=$("#create-banner");_.bindAll(this,"render");this.delegateEvents();this.render()},render:function(){$(this.el).html(this.template());return this},navigateToCreatePage:function(){Tracker.trackClick("events_home_create_jsbeacon");Router.send(Router.routes.CreateEventStep1Page,{});return false}});var CreateEventStep1PageView=Backbone.View.extend({template:JST.createEventStep1Page,el:"#page-content",createAnyWay:false,essentialInputsView:null,inProgress:false,events:{"click #submit":"submit","click #cancel-create":"navigateToHome"},initialize:function(a){_.bindAll(this,"createNewEvent","render","submit","displayValidationErrors","validateAddress","renderAddressSearchResults","navigateToHome","spinnerOnCreate");this.delegateEvents();if(a.event){this.model=new Event({id:a.event});this.model.fields="title,starts_at,ends_at,time_zone,venue,is_virtual,logo_key";this.model.fetch({success:this.render})}else{Backbone.sync("read",{url:"/events/new"},{success:this.createNewEvent,error:function(){alert("could not get a valid token, please refresh and try again...")}})}},createNewEvent:function(a){this.model=new Event(a);this.render()},render:function(){pageView.hideSpinner();var a=$(this.template());this.essentialInputsView=new EventEssentialInputsView({model:this.model});$(this.el).html(this.template());$(this.el).find(".content").prepend(this.essentialInputsView.el);return this},spinnerOnCreate:function(f){if(f){$(this.el).find("#submit").css({opacity:0.5});var c=$(this.el).find("#submit").parent();c.append("<div id='create-spinner1'></div>");var b=c.offset().left+$(this.el).find("#submit").width()/2+10;var d=c.offset().top+$(this.el).find("#submit").height()/2+15;var a=$("#create-spinner1");var e=new Spinner(VerySmallSpinnerOpts).spin();a.css({position:"absolute",top:d,left:b,"z-index":10}).html(e.el)}else{$("#create-spinner1").remove();$(this.el).find("#submit").css({opacity:1})}},submit:function(){if(this.inProgress){return}this.inProgress=true;this.essentialInputsView.propagateInputsToModel();this.$(".validation-error").remove();if(this.createAnyWay){this.model.set({bypass_dup_check:true})}this.createAnyWay=false;this.spinnerOnCreate(true);this.model.save({},{error:this.displayValidationErrors,success:function(a){this.inProgress=false;Router.send(Router.routes.CreateEventStep2Page,{event:a.get("id")})}})},displayValidationErrors:function(c,b){this.inProgress=false;this.spinnerOnCreate(false);var a=this;var d=b.errors;a.$(".global-error").html("");if(d.dupes){console.log(d);this.createAnyWay=true;this.$(".global-error").append('<div class="global-heading"> <div class="heading-one">This event may already exist...</div></div>');_.each(d.dupes,function(f){console.log(f);if(f.logo_url==null||f.logo_url==undefined){f.logo_url=eventsAssetUrl+"/images/default_event_logo.png"}else{f.logo_url=eventsAssetUrl+f.logo_url}if(f.attendee_count==1){f.sapText=f.attendee_count+" attendee"}else{if(f.attendee_count>1){f.sapText=f.attendee_count+" attendees"}}var e=new DupeEventView({model:f});a.$(".global-error").append(e.render().el)});$(this.el).find("#submit").html("Create Event Anyway");$(this.el).find("#submit").addClass("btn-primary").css({opacity:1})}a.essentialInputsView.displayValidationErrors(d)},validateAddress:function(a){OS.makeRequest("http://maps.google.com/maps/geo?q="+$(a.target).val().replace(/\s/gi,"%20"),this.renderAddressSearchResults);return},renderAddressSearchResults:function(c){var b=c.data.Placemark;var a="";for(var d in b){if(b[d].address!=null&&b[d].address.length>0){a+="<div>"+b[d].address+"</div>"}}if(a.length>0){$(".addressSearchResults").html(a)}},navigateToHome:function(){Router.send(Router.routes.HomePage,{});return false}});var CreateEventStep2PageView=Backbone.View.extend({template:JST.createEventStep2Page,el:"#page-content",extraInputsView:null,inProgress:false,events:{"click #submit":"submit","click #go-back":"goBack"},initialize:function(a){this.model=new Event({id:a.event});this.model.fields="description,industry_id,tag_list,hashtag_list,website,registration_required,owner_id";_.bindAll(this,"goBack","render","submit","displayValidationErrors","spinnerOnCreate");this.delegateEvents();this.model.fetch({success:this.render,error:function(){alert("Failed to load event, please refresh and try again...")}})},render:function(){pageView.hideSpinner();$(this.el).html(this.template());this.extraInputsView=new EventExtraInputsView({model:this.model});this.$(".content").prepend(this.extraInputsView.el);return this},spinnerOnCreate:function(e){if(e){$(this.el).find("#submit").css({opacity:0.5});var b=$(this.el).find("#submit").parent();b.append("<div id='create-spinner2'></div>");var a=b.offset().left+$(this.el).find("#submit").width()/2+10;var c=b.offset().top+$(this.el).find("#submit").height()/2+15;var f=$("#create-spinner2");var d=new Spinner(VerySmallSpinnerOpts).spin();f.css({position:"absolute",top:c,left:a,"z-index":10}).html(d.el)}else{$("#create-spinner2").remove();$(this.el).find("#submit").css({opacity:1})}},submit:function(){if(this.inProgress){return}this.inProgress=true;this.extraInputsView.propagateInputsToModel();this.$(".validation-error").remove();this.spinnerOnCreate(true);this.model.save({},{error:this.displayValidationErrors,success:function(a){Router.send(Router.routes.CreateEventStep3Page,{event:a.get("id")})}})},goBack:function(){Router.send(Router.routes.CreateEventStep1Page,{event:this.model.get("id")})},displayValidationErrors:function(b,a){this.inProgress=true;this.spinnerOnCreate(false);var c=a.errors;if(c){this.extraInputsView.displayValidationErrors(c)}this.inProgress=false}});var CreateEventStep3PageView=Backbone.View.extend({template:JST.createEventStep3Page,el:"#page-content",extraInputsView:null,inProgress:false,events:{"click #twitter-share":"shareOnTwitter","click #facebook-share":"shareOnFacebook","click #share-finish":"navigateToDetail","click #share-go-back":"navigateToStep2","click #skip-share-step":"navigateToDetail"},initialize:function(b){this.model=new Event({id:b.event});this.model.fields="create_share_urls,title,description,formatted_date,venue,logo_url";_.bindAll(this,"render","shareOnTwitter","shareOnFacebook","navigateToDetail","navigateToStep2");this.delegateEvents();var a=this;this.model.fetch({success:function(){a.render()},error:function(){alert("Failed to load event, please refresh and try again...")}})},render:function(){pageView.hideSpinner();$(this.el).html(this.template());if(!this.model.get("create_share_urls").twitter){$(this.el).find(".twitter-share-content").hide()}return this},shareOnTwitter:function(){Share.shareOnTwitter("create",this.model.get("title"),this.model.get("create_share_urls").twitter);Tracker.trackClick("events_createsharing_twitter_jsbeacon",this.model.get("id"));return false},shareOnFacebook:function(){Share.shareOnFacebook("create",this.model.get("title"),this.model.get("create_share_urls").facebook);Tracker.trackClick("events_createsharing_facebook_jsbeacon",this.model.get("id"));return false},navigateToDetail:function(){Router.send(Router.routes.EventDetailPage,{event:this.model.get("id")});return false},navigateToStep2:function(){Router.send(Router.routes.CreateEventStep2Page,{event:this.model.get("id")});return false}});var DupeEventView=Backbone.View.extend({template:JST.dupeEvent,events:{"click .nav-to-detail":"navigateToDetail","click .nav-to-sap":"navigateToSap"},initialize:function(){_.bindAll(this,"render","navigateToSap","navigateToDetail");this.delegateEvents()},navigateToSap:function(){Router.send(Router.routes.SeeAllPeoplePage,{event:this.model.id});return false},navigateToDetail:function(){Router.send(Router.routes.EventDetailPage,{event:this.model.id});return false},render:function(){$(this.el).html(this.template(this.model));return this}});var EditEventPageView=Backbone.View.extend({el:"#page-content",template:JST.editEventPage,essentialInputsView:null,extraInputsView:null,events:{"click #submit":"submit","click #cancel-edit":"navigateToDetailPage"},initialize:function(a){_.bindAll(this,"displayValidationErrors","navigateToDetailPage","render","submit");this.delegateEvents();this.model=new Event({id:a.event});this.model.fields="title,starts_at,ends_at,time_zone,venue,is_virtual,logo_key";this.model.fields+=",description,industry_id,tag_list,hashtag_list,website,registration_required";this.model.fetch({success:this.render})},render:function(){pageView.hideSpinner();$(this.el).html(this.template());this.extraInputsView=new EventExtraInputsView({model:this.model});this.$(".content").prepend(this.extraInputsView.el);this.essentialInputsView=new EventEssentialInputsView({model:this.model});this.$(".content").prepend(this.essentialInputsView.el);OS.resize();return this},submit:function(){this.essentialInputsView.propagateInputsToModel();this.extraInputsView.propagateInputsToModel();this.$(".validation-error").remove();this.model.save({},{error:this.displayValidationErrors,success:this.navigateToDetailPage});return false},navigateToDetailPage:function(){Router.send(Router.routes.EventDetailPage,{event:this.model.get("id")});return false},displayValidationErrors:function(b,a){var c=a.errors;if(c){this.essentialInputsView.displayValidationErrors(c);this.extraInputsView.displayValidationErrors(c)}}});var ErrorPageView=Backbone.View.extend({template:JST.errorPage,max:100,errorParams:{},initialize:function(a){this.el=$("#page-content");this.errorParams=a;_.bindAll(this,"hideAllPages","render","showLogo","showBanner","showPeople","createPerson","crowdEffect");this.hideAllPages();this.render()},hideAllPages:function(){$("#opensocial-container div").hide()},render:function(){pageView.hideSpinner();$(this.el).html(this.template());var b=$(this.el).find("#error-page");var a=$("<img id='bgImg' src="+eventsAssetUrl+"/images/gravatar/wall.png>");b.append(a);a.css({position:"absolute","z-index":1,width:"100%",height:"100%"});$(this.el).fadeIn(1000);this.showPeople();OS.resize();return this},showLogo:function(b){var a=$("<img id='logo' src="+eventsAssetUrl+"/images/gravatar/calendar.png>");$(this.el).append(a);a.css({position:"absolute","z-index":2,left:b[0]-80,top:b[1]-40})},showBanner:function(){var a=$("<div id='error-msg-banner'>Events is currently experiencing high traffic..<p>Please try again.</p></div>");$(this.el).append(a);a.css({position:"absolute","z-index":2})},showPeople:function(){var c=$(this.el).find("#bgImg").width();var a=$(this.el).find("#bgImg").height();var d=[c/2,a/2];this.showLogo(d);this.showBanner();for(var b=0;b<this.max;b++){this.createPerson(d,Math.floor(Math.random()*11),b)}setInterval(this.crowdEffect,200)},createPerson:function(g,c,a){var b=$("<img id='person-"+a+"' src="+eventsAssetUrl+"/images/gravatar/v"+c+".png>");$(this.el).append(b);var f=this.max-a;f*=2;var e=g[0]+a*2*(-5+Math.ceil(Math.random()*10));var d=(g[1]+30)+a*2+Math.ceil(Math.random()*50);b.css({position:"absolute","z-index":a+5,left:e,top:d})},crowdEffect:function(){var b=Math.floor(Math.random()*this.max);var a=$(this.el).find("#person-"+b);var d=-5+Math.ceil(Math.random()*10);var c=-2+Math.ceil(Math.random()*4);d*=2;a.animate({left:"-="+d+"px",top:"-="+c+"px"},1000);a.animate({left:"+="+d+"px",top:"-="+c+"px"},1000);a.animate({left:"+="+d+"px",top:"-="+c+"px"},1000);a.animate({left:"-="+d+"px",top:"-="+c+"px"},1000)}});var AdsView=Backbone.View.extend({template:JST["eventDetailPage/ads"],page:null,initialize:function(a){this.page=a.page;if(this.page=="detail"){this.el=$("#detail-ad-slot")}else{if(this.page=="search"){this.el=$("#search-ad-slot")}else{this.el=$("#sap-ad-slot")}}_.bindAll(this,"render","setUpAdsData");if(Validator.validateBaseUrl()){this.render()}else{$(this.el).html("<div id= 'right-ad-slot'> Hello Ad</div>")}OS.resize()},render:function(){$(this.el).html(this.template(this.setUpAdsData()));return this},setUpAdsData:function(){var l=0;var a=0;var h=0;var b=0;var g="";var k="";var e=new Date().getTime();e+=((Math.random(1000)*100)%100);e=Math.floor(e);if(this.page==="detail"||this.page==="sap"){var j=this.model.get("starts_at_ts");var d=this.model.get("ends_at_ts");var f=new Date().getTime();if(f>d){a=0}else{if(f>j&&f<d){a=1}else{if(f<j){l=j-f;var n=Math.abs((l)/(1000*60*60*168));if(n<=1){a=2}else{if(n>1&&n<=4){a=3}else{if(n>4){a=4}}}}}}if(this.model.get("venue")){g=this.model.get("venue").country_code}if(this.model.get("viewer_rsvp")){var i=this.model.get("viewer_rsvp").role;if(i==="follower"){h=1}else{if(i==="attendee"){h=2}}}if(this.model.get("geo_region_code")){b=this.model.get("geo_region_code")}var m=0;var c=0;if(this.page=="sap"){k="events_sap";m=600;c=160}else{if(this.page=="detail"){m=250;c=300;k="event_detail"}}return({zone:k,eventId:this.model.get("id"),ereg:b,ecntry:g,eind:this.model.get("industry_id"),rec:a,rsvp:h,height:m,width:c,cacheBuster:e})}else{k="events_search";return({zone:k,eventId:0,ereg:0,ecntry:0,eind:0,rec:0,rsvp:0,rcode:0,height:600,width:160,cacheBuster:e})}}});var AttendeesView=Backbone.View.extend({template:JST["eventDetailPage/attendees"],eventId:null,breadCrumbData:null,events:{"click .count":"navigateToSeeAllPeoplePage","click .users .user .ext":"trackUser"},initialize:function(a){this.breadCrumbData=a.breadCrumbData;this.el=$("#rsvp-info").find(".attendees");this.eventId=a.eventId;this.render();this.delegateEvents();_.bindAll(this,"render","refreshView","navigateToSeeAllPeoplePage","trackUser");this.model.bind("change",this.render)},render:function(){$(this.el).html(this.template(this.model.deepToJSON()));return this},navigateToSeeAllPeoplePage:function(){Router.send(Router.routes.SeeAllPeoplePage,{event:this.eventId,breadCrumbData:this.breadCrumbData});return false},refreshView:function(){this.model.fetch()},trackUser:function(b){var a=$(b.target);if(b.target instanceof HTMLImageElement){a=$(b.target).parent()}Tracker.trackClick("events_detail_attendeeprofile_jsbeacon",a.attr("href"));return true}});var ChartsItemView=Backbone.View.extend({template:JST["eventDetailPage/chartsItem"],eventId:null,breadCrumbData:null,events:{"click .val":"selectFacet","click .ct":"selectFacet"},initialize:function(a){_.bindAll(this,"render");this.render();this.breadCrumbData=a.breadCrumbData;this.eventId=a.eventId;this.delegateEvents()},render:function(){$(this.el).css("margin-bottom","6px");$(this.el).css("overflow","hidden");$(this.el).html(this.template(this.model.toJSON()));return this},selectFacet:function(){Tracker.trackClick("events_detail_sapchart_jsbeacon",this.eventId);Router.send(Router.routes.SeeAllPeoplePage,{event:this.eventId,breadCrumbData:this.breadCrumbData})}});var ChartsView=Backbone.View.extend({template:JST["eventDetailPage/charts"],chartsCollection:null,companyFacets:null,eventId:null,breadCrumbData:null,events:{"click #sap-link":"navigateToSeeAllPeoplePage"},initialize:function(a){this.el=$("#rsvp-info").find(".charts");this.breadCrumbData=a.breadCrumbData;_.bindAll(this,"render","navigateToSeeAllPeoplePage");this.eventId=a.eventId;this.render();this.delegateEvents();OS.resize();this.model.bind("change:rsvps",this.render)},render:function(){this.companyFacets=this.model.get("rsvps").facets_info.facets[0].items.slice(0,5);var a=this;var b=a.template(a.companyFacets);$(a.el).html(b);var c=new FacetItemsCollection([],{items:this.companyFacets,pxWidth:225});_.each(c.models,function(e){var d=new ChartsItemView({model:e,eventId:a.eventId,breadCrumbData:a.breadCrumbData});$(a.el).find(".items").append(d.render().el)});OS.resize()},navigateToSeeAllPeoplePage:function(){Tracker.trackClick("events_detail_sapchart_jsbeacon",this.eventId);Router.send(Router.routes.SeeAllPeoplePage,{event:this.eventId,breadCrumbData:this.breadCrumbData})}});var EventDetailPageView=Backbone.View.extend({template:JST["eventDetailPage/eventDetailPage"],eventInfoView:null,rsvpInfoView:null,updatesInfoView:null,locationView:null,matchmakerView:null,sharesView:null,ownerControlsView:null,breadCrumbData:null,similarEventsView:null,adsView:null,sourceType:null,events:{"click #events-home":"takeMeHome"},initialize:function(b){var a=this;this.sourceType=b.referrer;this.el=$("#page-content");this.delegateEvents();_.bindAll(this,"render","showEventDetails","takeMeHome","reflectViewerRoleChange");this.breadCrumbData=b.breadCrumbData;this.model=new Event({id:b.event});this.model.include="viewer_rsvp,updates,rsvps(role:attendee,sort:network,count:10,facets_info:true),matches(count:5)";this.model.fetch({success:function(){pageView.hideSpinner();a.model.viewer.bind("change:role",a.reflectViewerRoleChange);a.render();a.showEventDetails()},error:function(c,d){if(d.error==="event not found"){Router.send(Router.routes.HomePage,{cd:1});return}pageView.hideSpinner()}})},render:function(){$(this.el).html(this.template());if(this.breadCrumbData){var a={list:[{title:"Events Home",link:true,page:Router.routes.HomePage,params:{}},{title:"Search Results",link:true,page:Router.routes.SearchPage,params:{q:this.breadCrumbData}},{title:this.model.get("title"),link:false}]};this.breadCrumbView=new BreadCrumbView(a)}else{var a={list:[{title:"Events Home",link:true,page:Router.routes.HomePage,params:{}},{title:this.model.get("title"),link:false}]};this.breadCrumbView=new BreadCrumbView(a)}return this},showEventDetails:function(){if(this.model.get("tag_list").length>0){this.model.set({labels:this.model.get("tag_list").join(", ")})}this.eventInfoView=new EventInfoView({model:this.model.toJSON()});this.rsvpActionView=new RsvpActionView({model:this.model.viewer,sourceType:this.sourceType});if(this.model.get("matches").count!=0){this.matchmakerView=new MatchmakerView({model:this.model,breadCrumbData:this.breadCrumbData})}else{$(this.el).find("#matchmaker").hide()}this.sharesView=new SharesView({model:this.model});if(this.model.get("rsvps").total>0){this.rsvpInfoView=new RsvpInfoView({model:this.model,breadCrumbData:this.breadCrumbData})}else{$("#rsvp-info").hide()}this.adsView=new AdsView({page:"detail",model:this.model});this.updatesInfoView=new UpdatesInfoView({model:this.model.updatesPage});var b=this.model.get("venue")||{};this.locationView=new LocationView({model:b,eventId:this.model.get("id")});var a=this.model.get("owner").id;var c=this.model.viewer.get("user").id;if(a===c){this.ownerControlsView=new OwnerControlsView({model:this.model});this.$(".right-section-small").prepend(this.ownerControlsView.render().el)}this.similarEventsView=new SimilarEventsView({eventId:this.model.get("id")})},takeMeHome:function(){Router.send(Router.routes.HomePage,{})},reflectViewerRoleChange:function(){this.model.fetch()}});var EventInfoView=Backbone.View.extend({template:JST["eventDetailPage/eventInfo"],onedesc:"",twodesc:"",events:{"click .more #show-more":"toggleInfoContent","click .url .ext":"trackWebsite"},initialize:function(){this.el=$("#event-details");_.bindAll(this,"render","toggleInfoContent","convertUrlTextToLinks","trackWebsite");this.delegateEvents();this.render()},render:function(){var e=this.model.description;if(e&&e.length){e=_.escape(e);var b=e.substring(0,300).split(" ").slice(0,-1).join(" ");b+="...";var d="";var c="";var a=this;_.each(b.split("\n"),function(f){if(f.length>1){a.onedesc+="<div class='paragraph'>"+f+"</div>"}});_.each(e.split("\n"),function(f){if(f.length>1){a.twodesc+="<div class='paragraph'>"+f+"</div>"}});if(e.length<300){this.onedesc=this.model.description}$(this.el).html(this.template(this.model));$(this.el).find("#less").html(this.onedesc);if(e.length<300){$(this.el).find(".event-info-text .text  .description .labels").show();$(this.el).find("#show-more").hide()}else{$(this.el).find(".event-info-text .text  .description .labels").hide()}this.convertUrlTextToLinks()}else{$(this.el).html(this.template(this.model));$(this.el).find("#show-more").hide();$(this.el).find(".event-info-text .text  .description .labels").show()}OS.resize();return this},toggleInfoContent:function(a){if($(a.target).html().indexOf("Show more")!==-1){$(a.target).html("Show less...");$(this.el).find("#less").html(this.twodesc);$(this.el).find(".event-info-text .text  .description .labels").show()}else{$(a.target).html("Show more...");$(this.el).find("#less").html(this.onedesc);$(this.el).find(".event-info-text .text  .description .labels").hide()}this.convertUrlTextToLinks();OS.resize();return false},convertUrlTextToLinks:function(){$(this.el).find(".description .paragraph").each(function(a,b){var f=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;var d=$(this).html().replace(f,'<a target="_blank" href="$1">$1</a>');var e=/(^|[^\/])(www\.[\S]+(\b|$))/gim;d=d.replace(e,' <a target="_blank" href="http://$2">$2</a>');var c=/(\w+@[-A-Z0-9+&@#\/%=~_|]+?\.[a-zA-Z]{2,6})/gim;d=d.replace(c,'<a href="mailto:$1">$1</a>');$(this).html(d)});OS.resize()},trackWebsite:function(b){var a=$(b.target);if(b.target instanceof HTMLImageElement){a=$(b.target).parent()}Tracker.trackClick("events_detail_websitelink_jsbeacon",a.attr("href"));return true}});var MyGMapsHandler={locationView:null,loadMaps:function(){var a=document.createElement("script");a.type="text/javascript";a.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=MyGMapsHandler.loadLocation";document.body.appendChild(a)},loadLocation:function(){MyGMapsHandler.locationView.render()}};var LocationView=Backbone.View.extend({venue:null,template:JST["eventDetailPage/location"],mapsUrl:"http://maps.google.com/maps?saddr=&daddr=",completeAddress:null,eventId:null,initialize:function(a){MyGMapsHandler.locationView=this;this.venue=this.model;this.eventId=a.eventId;this.el=$("#event-location-module");_.bindAll(this,"render");MyGMapsHandler.loadMaps();OS.resize()},render:function(){$("#event-location-module").css("display","none");if(this.venue.address){geocoder=new google.maps.Geocoder();var b="";if(this.venue.address){b+=this.venue.address+" "}if(this.venue.city){b+=this.venue.city+" "}if(this.venue.postal_code){b+=this.venue.postal_code+" "}this.completeAddress=b;var a=this;geocoder.geocode({address:this.completeAddress},function(h,f){if(f==google.maps.GeocoderStatus.OK){$("#event-location-module").css("display","block");$(a.el).html(a.template(a.model));$(a.el).find("#get-directions-link").attr("href",a.mapsUrl+encodeURIComponent(a.completeAddress));$(a.el).find("#get-directions-link").click(function(){Tracker.trackClick("events_detail_getdirections_jsbeacon",a.eventId);return true});var c=h[0].geometry.location.Ka;var g=h[0].geometry.location.La;var e={zoom:15,center:h[0].geometry.location,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:true,zoomControl:false,enableCloseButton:false,panControl:false,linksControl:false,disableDoubleClickZoom:true,addressControl:false,draggable:true,streetViewControl:true,mapTypeControl:true};map=new google.maps.Map(document.getElementById("venue-maps"),e);map.setCenter(h[0].geometry.location);var d=new google.maps.Marker({map:map,streetViewControl:false,position:h[0].geometry.location});OS.resize()}});return this}}});var MatchedUserView=Backbone.View.extend({template:JST["eventDetailPage/matchedUser"],parentView:null,meetingsView:null,eventInfo:null,events:{"click #remove-user":"hideAndRemoveFromCollection","click #request-meeting .meeting":"openMeetingDialog","click .photo-container .ext":"trackUser","click .placement .ext":"trackUser"},initialize:function(a){this.parentView=a.parent;this.eventInfo=a.parent.model;_.bindAll(this,"render","hideAndRemoveFromCollection","openMeetingDialog","trackUser");this.delegateEvents()},render:function(){var a=eventsAssetUrl+"/images/icon_no_photo_no_border_60x60.png";if(!this.model.get("thumbnail_url")){this.model.set({thumbnail_url:a})}$(this.el).html(this.template(this.model.toJSON()));return this},hideAndRemoveFromCollection:function(){this.parentView.removedHeight=$(this.el).height();$(this.el).animate({height:0},500,function(){$(this).hide();$(this).css("margin",0)});var a=this;a.model.collection.remove(a.model)},openMeetingDialog:function(){var a=this.model.toJSON();a.eventName=this.parentView.model.get("title");a.eventId=this.parentView.model.get("id");a.sender=OS.viewer.name.givenName;this.meetingsView=new RequestMeetingView({model:a});return false},trackUser:function(b){var a=$(b.target);if(b.target instanceof HTMLImageElement){a=$(b.target).parent()}Tracker.trackClick("events_detail_matchprofile_jsbeacon",a.attr("href"));return true}});var MatchmakerView=Backbone.View.extend({template:JST["eventDetailPage/matchmaker"],mettingsView:null,eventId:null,eventTitle:null,matchmakerCollection:null,removedHeight:null,currentHeightRendered:null,breadCrumbData:null,events:{"click #matchmaker #aymm":"navigateToSeeAllPeoplePage","click #matchmaker #sap":"navigateToSeeAllPeoplePage"},initialize:function(a){this.eventId=this.model.get("id");this.breadCrumbData=a.breadCrumbData;this.matchmakerCollection=new MatchmakerCollection({event:this.model});this.el=$("#matchmaker");_.bindAll(this,"render","navigateToSeeAllPeoplePage","updateView");this.delegateEvents();this.render()},render:function(){var b=this;var d=0;$(this.el).html(this.template());this.matchmakerCollection.bind("remove",this.updateView);for(var c=0;c<b.matchmakerCollection.models.length;c++){var a=new MatchedUserView({model:b.matchmakerCollection.getOne(),parent:this});$(b.el).find("#matches").append(a.render().el);if(c==2){break}}OS.resize();this.currentHeightRendered=$(this.el).find("#matches").height();$(this.el).find("#matches").css("min-height",this.currentHeightRendered);return this},updateView:function(){var c=this.matchmakerCollection.getOne();if(c){var a=new MatchedUserView({model:c,parent:this});$(a.el).hide();$(this.el).find("#matches").append(a.render().el);setTimeout(function(){a.currentHeightRendered=a.currentHeightRendered-a.removedHeight+$(a.el).height();$(a.el).find("#matches").css("max-height",a.currentHeightRendered);$(a.el).show()},400);this.matchmakerCollection.updateState()}else{var b=this;setTimeout(function(){b.currentHeightRendered=b.currentHeightRendered-b.removedHeight;$(b.el).find("#matches").css("max-height",b.currentHeightRendered);$(b.el).find("#matches").css("min-height",b.currentHeightRendered);if(b.currentHeightRendered<50){$("#matchmaker").hide()}},400)}},navigateToSeeAllPeoplePage:function(){Router.send(Router.routes.SeeAllPeoplePage,{event:this.eventId,breadCrumbData:this.breadCrumbData});return false}});var OwnerControlsView=Backbone.View.extend({id:"owner-controls",template:JST["eventDetailPage/ownerControls"],events:{"click .edit-event-btn":"navigateToEditPage","click .delete-event-btn":"showDialogForConfirmation"},initialize:function(){_.bindAll(this,"render","navigateToEditPage","deleteEvent","deleteEventSuccess","deleteEventFailure","showDialogForConfirmation");this.delegateEvents();Tracker.trackPage("events_detailowner_jsbeacon",this.model.get("id"))},render:function(){$(this.el).html(this.template());return this},navigateToEditPage:function(){Tracker.trackClick("events_detailowner_edit_jsbeacon",this.model.get("id"));Router.send(Router.routes.EditEventPage,{event:this.model.get("id")});return false},deleteEvent:function(){Tracker.trackClick("events_detailowner_delete_jsbeacon",this.model.get("id"));var a=this;Backbone.sync("delete",{url:"/events/"+this.model.get("id")},{success:function(){a.deleteEventSuccess()},error:function(){a.deleteEventFailure()}})},deleteEventSuccess:function(){Router.send(Router.routes.HomePage,{cd:2})},deleteEventFailure:function(){banner.publish("error","This event could not be deleted. Please refresh the page and try again.")},showDialogForConfirmation:function(){$("#wrapper").html(JST["eventDetailPage/deleteEventConfirmBox"]);this.dialog=LI.Dialog();var a=this;this.dialog.closeEvent.subscribe(function(){a.dialog.close();$("#wrapper").empty();a.dialog=null});this.dialog.submitEvent.subscribe(function(){a.deleteEvent();a.dialog.close();$("#wrapper").empty();a.dialog=null});this.dialog.open(window.event,{name:"request-meeting-dialog",type:"task-modeless",width:450,className:"request-meeting",content:{node:"wrapper-main",title:"Delete Event"}});$("#wrapper-main").show()}});var RsvpActionView=Backbone.View.extend({eventId:null,sourceType:null,template:JST["eventDetailPage/rsvpAction"],events:{"click .attending-btn":"attendEvent","click .attending-cnf-btn":"showDropDown","click .following-btn":"followEvent","click .following-cnf-btn":"showDropDown","click .invite-btn":"inviteEvent","click .li-attending":"attendEvent","click .li-following":"followEvent","click .li-not-attending-or-following":"unAttendEvent"},initialize:function(a){this.eventId=this.model.eventId;this.sourceType=a.sourceType;this.el=$("#rsvp-action");this.render();_.bindAll(this,"render","showViewerStatus","attendEvent","unAttendEvent","followEvent","unFollowEvent","roleChangeSuccessful","inviteEvent","showDropDown","returntoDefaultState","hideDropDownMenu","showSpinner","hideSpinner");this.model.bind("change:role",this.showViewerStatus);this.showViewerStatus();this.delegateEvents();this.ical_url=eventsBaseUrl+"/events/"+this.eventId+"/calendar";$(this.el).find(".calendar-anchor").attr("href",this.ical_url)},render:function(){$(this.el).html(this.template(this.model));var a=this;$(document).click(function(){a.hideDropDownMenu()});return this},showViewerStatus:function(){var a=this.model.get("role");switch(a){case"attendee":this.buttonShow(".attending-cnf-btn");this.buttonHide(".attending-btn");this.buttonHide(".following-btn");this.buttonHide(".following-cnf-btn");break;case"follower":this.buttonShow(".attending-btn");this.buttonShow(".following-cnf-btn");this.buttonHide(".attending-cnf-btn");this.buttonHide(".following-btn");break;default:this.buttonShow(".attending-btn");this.buttonShow(".following-btn");this.buttonHide(".following-cnf-btn");this.buttonHide(".attending-cnf-btn")}this.$(".calendar-link").toggle(a==="attendee")},buttonHide:function(a){this.$(a).addClass("hide-rsvp-action").removeClass("display-rsvp-action")},buttonShow:function(a){this.$(a).addClass("display-rsvp-action").removeClass("hide-rsvp-action")},attendEvent:function(){if(this.sourceType){var c=this.eventId+"_source_"+this.sourceType;Tracker.trackClick("events_detail_rsvp_jsbeacon",c)}else{Tracker.trackClick("events_detail_rsvp_jsbeacon",this.eventId)}this.hideDropDownMenu();var d=this.model.get("role");var b=d==="attendee";if(!b){var a=this;this.showSpinner();Backbone.sync("update",{url:"/events/"+this.eventId+"/rsvps/"+this.model.get("user").id,role:"attendee"},{success:function(){a.roleChangeSuccessful("attendee");a.hideDropDownMenu();a.hideSpinner()},error:function(){a.hideSpinner()}})}return false},unAttendEvent:function(){if(this.sourceType){var b=this.eventId+"_source_"+this.sourceType;Tracker.trackClick("events_detail_unrsvp_jsbeacon",b)}else{Tracker.trackClick("events_detail_unrsvp_jsbeacon",this.eventId)}this.hideDropDownMenu();var a=this;this.showSpinner();Backbone.sync("update",{url:"/events/"+this.eventId+"/rsvps/"+this.model.get("user").id,role:"none"},{success:function(){a.roleChangeSuccessful("none");a.hideDropDownMenu();a.hideSpinner()},error:function(){a.hideSpinner()}});return false},hideDropDownMenu:function(){$(this.el).find(".btn-drop").addClass("hide-rsvp-action").removeClass("display-rsvp-action")},followEvent:function(c){if(this.sourceType){var d=this.eventId+"_source_"+this.sourceType;Tracker.trackClick("events_detail_follow_jsbeacon",d)}else{Tracker.trackClick("events_detail_follow_jsbeacon",this.eventId)}this.hideDropDownMenu();var f=this.model.get("role");var b=f==="follower";if(!b){if(this.model.get("role")!=="attendee"||$(c.target).hasClass("li-following")){this.showSpinner();var a=this;Backbone.sync("update",{url:"/events/"+this.eventId+"/rsvps/"+this.model.get("user").id,role:"follower"},{success:function(){a.roleChangeSuccessful("follower");a.hideDropDownMenu();a.hideSpinner()},error:function(){a.hideSpinner()}})}else{this.alreadyFollowing()}}return false},unFollowEvent:function(){this.hideDropDownMenu();var a=this;this.showSpinner();Backbone.sync("update",{url:"/events/"+this.eventId+"/rsvps/"+this.model.get("user").id,role:"none"},{success:function(){a.roleChangeSuccessful("none");a.hideDropDownMenu();a.hideSpinner()},error:function(){a.hideSpinner()}});return false},showSpinner:function(){var c=$(this.el);c.append("<div id='rsvp-spinner'></div>");var b=c.offset().left+65;var d=c.offset().top+12;var a=$("#rsvp-spinner");var e=new Spinner(VerySmallSpinnerOpts).spin();a.css({position:"absolute",top:d,left:b,"z-index":100}).html(e.el)},hideSpinner:function(){$("#rsvp-spinner").html("")},alreadyFollowing:function(){this.hideDropDownMenu();banner.publish("info","As an attendee you are automatically following this event.");return false},returntoDefaultState:function(){},roleChangeSuccessful:function(b){var a=this.model.get("role");this.model.set({role:b})},inviteEvent:function(){},showDropDown:function(a){a.stopPropagation();var c=this.model.get("role");if($(this.el).find(".btn-drop").css("display")==="none"){var b=null;if($(a.target).hasClass("btn-drop-down")){b=$(a.target).parent().offset()}else{b=$(a.target).offset()}$(this.el).find(".btn-drop").css("top",b.top+23);$(this.el).find(".btn-drop").css("left",b.left);if(c==="attendee"){$(this.el).find(".btn-drop .li-attending").addClass("tic-green");$(this.el).find(".btn-drop .li-attending").css("cursor","none");$(this.el).find(".btn-drop .li-following").removeClass("tic-green");$(this.el).find(".btn-drop .li-following").css("cursor","pointer")}if(c==="follower"){$(this.el).find(".btn-drop .li-following").addClass("tic-green");$(this.el).find(".btn-drop .li-following").css("cursor","none");$(this.el).find(".btn-drop .li-attending").removeClass("tic-green");$(this.el).find(".btn-drop .li-attending").css("cursor","pointer")}$(this.el).find(".btn-drop").removeClass("hide-rsvp-action").addClass("display-rsvp-action")}else{if($(this.el).find(".btn-drop").css("display")==="block"){$(this.el).find(".btn-drop").addClass("hide-rsvp-action").removeClass("display-rsvp-action")}}return false}});var RsvpInfoView=Backbone.View.extend({attendeesView:null,chartsView:null,template:JST["eventDetailPage/rsvpInfo"],initialize:function(a){this.el=$("#rsvp-info");this.render();_.bindAll(this,"render");this.attendeesView=new AttendeesView({model:this.model.rosterPage,eventId:this.model.get("id"),breadCrumbData:a.breadCrumbData});this.chartsView=new ChartsView({model:this.model,eventId:this.model.get("id"),breadCrumbData:a.breadCrumbData});OS.resize()},render:function(){$(this.el).html(this.template(this.model.toJSON()));return this}});var SharesView=Backbone.View.extend({share_urls:null,url:null,eventId:null,template:JST["eventDetailPage/shares"],events:{"click #linkedin":"shareOnLinkedIn","click #facebook":"shareOnFacebook","click #twitter":"shareOnTwitter"},initialize:function(){this.share_urls=this.model.get("detail_share_urls");this.eventId=this.model.get("id");this.el=$("#share-module");this.render();this.delegateEvents();_.bindAll(this,"render","shareOnLinkedIn","shareOnFacebook","shareOnTwitter");OS.resize()},render:function(){$(this.el).html(this.template({url:this.share_urls.short_link}));if(!this.share_urls.twitter){$(this.el).find("#twitter").hide()}if(!this.share_urls.short_link){$(this.el).find(".embed-url").hide()}return this},shareOnLinkedIn:function(){Share.shareOnLinkedIn("detail",this.model.get("title"),this.share_urls.linkedin,this.model.get("description"));Tracker.trackClick("events_detail_inshare_jsbeacon",this.eventId);return false},shareOnFacebook:function(){Share.shareOnFacebook("detail",this.model.get("title"),this.share_urls.facebook);Tracker.trackClick("events_detail_facebook_jsbeacon",this.eventId);return false},shareOnTwitter:function(){Share.shareOnTwitter("detail",this.model.get("title"),this.share_urls.twitter);Tracker.trackClick("events_detail_twitter_jsbeacon",this.eventId);return false}});var SimilarEventsView=Backbone.View.extend({template:JST["eventDetailPage/similarEvents"],eventId:null,similarEvents:null,events:{"click .sim-detail":"navigateToDetail","click .sim-sap":"navigateToSap"},initialize:function(b){this.el=$("#similar-events");$(this.el).hide();this.eventId=b.eventId;_.bindAll(this,"render","navigateToDetail","navigateToSap");this.delegateEvents();var a=this;Backbone.sync("read",{url:"/events/"+a.eventId+"/similar?fields=title,logo_url,formatted_date,venue,attendee_count"},{success:function(c){a.similarEvents=c.items;if(c.items&&c.items.length>=1){a.render()}},error:function(){}})},render:function(){$(this.el).html(this.template());var a=this;_.each(this.similarEvents,function(c){if(!c.logo_url){c.logo_url=eventsAssetUrl+"/images/default_event_logo.png"}if(c.title.length>50){c.title=c.title.substring(0,47)+"..."}var d="";if(c.attendee_count==0){d=null}else{d=c.attendee_count+" attending"}c.sentence=d;var b=JST["eventDetailPage/simEvent"];$(a.el).find(".events").append(b(c))});$(this.el).show();OS.resize();return this},navigateToDetail:function(b){var a=$(b.target).parent().parent().parent().attr("id");Tracker.trackClick("events_detail_eyml_jsbeacon",a);Router.send(Router.routes.EventDetailPage,{event:a,referrer:"similarevents"});return false},navigateToSap:function(b){var a=$(b.target).parent().parent().parent().attr("id");Tracker.trackClick("events_detail_eyml_jsbeacon",a);Router.send(Router.routes.SeeAllPeoplePage,{event:a});return false}});var UpdatePostActionView=Backbone.View.extend({eventId:null,textBoxMaxHeight:200,textBoxDefaultHeight:45,template:JST["eventDetailPage/updateCommentBox"],ghostText:"Introduce yourself, share information, or ask a question.",events:{"click .share-button":"tryPostingComment"},initialize:function(a){this.el=$(".comment-post");this.eventId=a.eventId;this.delegateEvents();_.bindAll(this,"render","toggleGhostText","postComment","renderUserThumbnail","tryPostingComment","postCommentError","postCommentSuccess","activateTextAreaExpanson");this.delegateEvents();this.render();this.renderUserThumbnail();OS.resize();this.activateTextAreaExpanson()},render:function(){var b=this;$(this.el).html(this.template(OS.viewer));b.toggleGhostText(true);var a=$(this.el).find("#post_comment_box");a.focus(function(){b.toggleGhostText(false)});a.blur(function(){b.toggleGhostText(true)});return this},toggleGhostText:function(a){var b=$(this.el).find("#post_comment_box");if(a){if(b.val().length==0){b.val(this.ghostText);b.css("color","#666")}}else{if(b.val().length>0&&b.val()==this.ghostText){b.val("");b.css("color","#333")}}},renderUserThumbnail:function(){if(OS.viewer.thumbnailUrl){$(".user-thumbnail").attr("src",OS.viewer.thumbnailUrl)}else{$(".user-thumbnail").attr("src",eventsAssetUrl+"/images/icon_no_photo_no_border_60x60.png")}},tryPostingComment:function(){var a=$(this.el).find("#post_comment_box").val();if(a.length>0&&a!==this.ghostText){this.postComment()}},postComment:function(){var a=$(this.el).find("#post_comment_box").val();var b={url:"/events/"+this.eventId+"/comments",text:a};Backbone.sync("create",b,{success:this.postCommentSuccess,error:this.postCommentError})},postCommentSuccess:function(){$(this.el).find("#post_comment_box").val("");$(this.el).find(".post-error").html("");eventDetailPageView.model.updatesPage.fetch()},postCommentError:function(a){if(a.errors&&a.errors.comments){$(this.el).find(".post-error").html("");$(this.el).find(".post-error").append("<span>"+a.errors.comments[0]+"</span>")}},activateTextAreaExpanson:function(){CheckTextarea($("#post_comment_box").get()[0],{maxLength:2000,grow:{maxHeight:60,onFocus:60}});OS.resize()}});var UpdateView=Backbone.View.extend({template:JST["eventDetailPage/update"],className:"user-update",events:{"click .user .ext":"trackUser","click .text .ext":"trackUser"},initialize:function(){_.bindAll(this,"render","trackUser");this.delegateEvents();this.model.bind("change",this.render)},render:function(){var a=this.model.toJSON();a.user=this.model.user.toJSON();$(this.el).html(this.template(a));return this},trackUser:function(b){var a=$(b.target);if(b.target instanceof HTMLImageElement){a=$(b.target).parent()}Tracker.trackClick("events_detail_commenterprofile_jsbeacon",a.attr("href"));return true}});var UpdatesInfoView=Backbone.View.extend({nextSequenceNumber:null,template:JST["eventDetailPage/updatesInfo"],events:{"click #show-more-btn":"showMoreUpdates","click #filter-comments":"selectCommentUpdates","click #filter-all":"selectAllUpdates"},initialize:function(){this.el=$("#updates-info");_.bindAll(this,"appendUpdates","replaceUpdates","replaceUpdatesAfterFilterChange","selectAllUpdates","selectCommentUpdates","showMoreUpdates","autoRefreshUpdateTimes","toggleSpinner");this.model.bind("change",this.replaceUpdates);this.render();this.replaceUpdates();this.delegateEvents();this.updatePostView=new UpdatePostActionView({eventId:this.model.eventId});OS.resize()},render:function(){$(this.el).html(this.template());if(this.model.get("type")=="comment"){this.$("#filter-comments").addClass("active")}else{this.$("#filter-all").addClass("active")}return this},autoRefreshUpdateTimes:function(){$("abbr.timeago").timeago()},replaceUpdates:function(){this.renderUpdatesPage(this.model,"html")},replaceUpdatesAfterFilterChange:function(){this.$(".updates").css({opacity:1});this.$(".spinner").remove();this.replaceUpdates()},appendUpdates:function(a){this.toggleSpinner(false);this.renderUpdatesPage(a,"append");OS.resize()},renderUpdatesPage:function(a,c){var b=this.renderPage(a);this.$(".updates")[c](b);if(a.get("start")+a.get("count")<a.get("total")){this.nextSequenceNumber=a.get("items")[a.get("count")-1].sequence_number}else{this.nextSequenceNumber=null}this.toggleShowMoreButton();OS.resize();this.autoRefreshUpdateTimes()},renderPage:function(a){return a.updates.map(function(c){var b=new UpdateView({model:c});return b.render().el})},toggleShowMoreButton:function(){if(this.nextSequenceNumber!=null){$(this.el).find("#show-more-btn").addClass("display-show-more").removeClass("hide-show-more")}else{$(this.el).find("#show-more-btn").addClass("hide-show-more").removeClass("display-show-more")}},showMoreUpdates:function(){Tracker.trackClick("events_detail_showmore_jsbeacon");this.toggleSpinner(true);var a=new UpdatesPage();a.eventId=this.model.eventId;a.start=this.nextSequenceNumber;if(this.model.has("type")){a.set({type:this.model.get("type")})}a.fetch({success:this.appendUpdates});return false},selectAllUpdates:function(){this.showFilterChangeSpinner();this.$("#filter-all").addClass("active");this.$("#filter-comments").removeClass("active");this.model.unset("type");this.model.fetch({success:this.replaceUpdatesAfterFilterChange});return false},selectCommentUpdates:function(){this.showFilterChangeSpinner();this.$("#filter-comments").addClass("active");this.$("#filter-all").removeClass("active");this.model.set({type:"comment"});this.model.fetch({success:this.replaceUpdatesAfterFilterChange});return false},showFilterChangeSpinner:function(){var a=this.$(".updates");a.css({opacity:0.3});a.parent().append('<div class="spinner"></div>');var b=a.offset().left+a.width()/2-20;var c=a.offset().top+a.height()/2;var d=new Spinner(SmallSpinnerOpts).spin();a.parent().find(".spinner").css({position:"absolute",top:c,left:b}).html(d.el)},toggleSpinner:function(b){if(b){$(this.el).find("#show-more-btn").css({opacity:0.5});$(this.el).find("#show-more-btn").html("");var d=$(this.el).find("#show-more-btn");d.append("<div id='show-more-updates-spinner'></div>");var c=d.offset().left+$(this.el).find("#show-more-btn").width()/2;var e=d.offset().top+$(this.el).find("#show-more-btn").height()/2+5;var a=$("#show-more-updates-spinner");var f=new Spinner(VerySmallSpinnerOpts).spin();a.css({position:"absolute",top:e,left:c,"z-index":10}).html(f.el)}else{$("#show-more-updates-spinner").remove();$(this.el).find("#show-more-btn").css({opacity:1});$(this.el).find("#show-more-btn").html("Show More...")}}});var EventEssentialInputsView=Backbone.View.extend({template:JST.eventEssentialInputs,id:"event-essentials",ghostText:"e.g. Cityplace Conference Center, Dallas",events:{"click #add-end-time":"revealEndsAt","click #add-street-address":"revealStreetAddress","click #event-is-virtual":"virtualnessHasChanged"},initialize:function(){_.bindAll(this,"revealEndsAt","revealStreetAddress","virtualnessHasChanged","toggleGhostText");this.delegateEvents();this.render()},render:function(){var e=this.model.get("logo_key");var g=eventsBaseUrl+"/pics/new?parent_key="+e;if(!this.model.isNew()){g+="&event_id="+this.model.id}$(this.el).html(this.template({url:g,logo_key:e}));var i=this;var d=$(this.el).find("#event-venue-name");d.focus(function(){i.toggleGhostText(false)});d.blur(function(){i.toggleGhostText(true)});this.toggleGhostText(true);this.$("#event-title").val(this.model.get("title"));this.$("input.datepicker").datepicker({dateFormat:"yy-mm-dd"});var c=JST.timeOptions();this.$("select.timepicker").html(c);this.populateTimeFields($(this.el),"start",this.defaultStartTime());this.populateTimeFields($(this.el),"end",this.defaultEndTime());if(this.model.has("ends_at")){this.$("#add-end-time").parent().hide()}else{this.$("#ends-at").hide()}var h=this.model.get("time_zone")||this.defaultTimeZone();var a=JST.timeZoneOptions();this.$("#event-time-zone").html(a).val(h);if(this.model.has("venue")){var b=this.model.get("venue");this.$("#event-venue-name").val(b.name);var f=_.compact([b.address,b.city,b.state]).join(", ");if(f){if(b.postal_code){if(b.state){f+=" "}else{f+=", "}f+=b.postal_code}this.$("#event-address").val(f);this.$("#add-street-address").parent().hide()}else{this.$("#street-address").hide()}}else{this.$("#street-address").hide()}this.$("#event-is-virtual").prop("checked",this.model.get("is_virtual"));this.virtualnessHasChanged()},propagateInputsToModel:function(){this.insertDefaultEndTime();this.model.unset("starts_at");this.model.unset("ends_at");this.model.unset("venue");this.model.set({title:this.$("#event-title").val()});this.model.set({is_virtual:this.$("#event-is-virtual").prop("checked")});if(this.model.get("is_virtual")){this.model.set({venue_name:null,address:null})}else{var a=this.$("#event-venue-name").val();if(a==this.ghostText){a=""}this.model.set({venue_name:a});this.model.set({address:this.$("#event-address").val()})}if(this.$("#event-start-date").val()){this.model.set({start_date:this.$("#event-start-date").val()});this.model.set({start_time:this.$("#event-start-time").val()})}if(this.$("#ends_at:visible")){if(this.$("#event-end-date").val()){this.model.set({end_date:this.$("#event-end-date").val()});this.model.set({end_time:this.$("#event-end-time").val()})}}this.model.set({time_zone:this.$("#event-time-zone").val()});this.model.set({logo_key:this.$("#logo-key").val()})},displayValidationErrors:function(b){var a=this;_.each(b,function(e,c){var d=_.first(e);var f=a.$("#event-"+c.replace(/_/gi,"-"));if(c=="starts_at"){f=a.$("#event-start-date")}else{if(c=="ends_at"){f=a.$("#event-end-date");a.revealEndsAt()}else{if(c=="address"){a.revealStreetAddress()}}}f.parent().append('<div class="validation-error">'+d+"</div>")})},revealEndsAt:function(){this.$("#add-end-time").parent().hide();this.insertDefaultEndTime();this.$("#ends-at").show();return false},revealStreetAddress:function(){this.$("#add-street-address").parent().hide();this.$("#street-address").show()},virtualnessHasChanged:function(){if(this.$("#event-is-virtual").prop("checked")){this.$("#physical-location").hide()}else{this.$("#physical-location").show()}},insertDefaultEndTime:function(){var a=this.$("#event-start-date").val();var d=this.$("#event-start-time").val().split(":");if(a&&d){if(!this.$("#event-end-date").val()){var c=$.datepicker.parseDate("yy-mm-dd",a);c.setUTCHours(parseInt(d[0],10),parseInt(d[1],10));var b=new Date(c.valueOf()+3*3600000);var e=toISOString(b);this.$("#event-end-date").val(e.substr(0,10));this.$("#event-end-time").val(e.substr(11,5))}}},populateTimeFields:function(a,d,b){var c=d+"s_at";if(this.model.has(c)){var e=this.model.get(c);a.find("#event-"+d+"-date").val(e.substr(0,10));a.find("#event-"+d+"-time").val(e.substr(11,5))}else{a.find("#event-"+d+"-time").val(b)}},defaultStartTime:function(){return"08:00"},defaultEndTime:function(){return"17:00"},defaultTimeZone:function(){return"America/Los_Angeles"},toggleGhostText:function(a){var b=$(this.el).find("#event-venue-name");if(a){if(b.val().length==0){b.val(this.ghostText);b.css("color","#666");b.css("font-size","12px")}}else{if(b.val().length>0&&b.val()==this.ghostText){b.val("");b.css("color","#333")}}}});var FooView=Backbone.View.extend({id:"monkey"});var EventExtraInputsView=Backbone.View.extend({id:"event-extras",template:JST.eventExtraInputs,initialize:function(){this.render()},render:function(){$(this.el).html(this.template());var a=JST.industryOptions();this.$("#event-industry-id").html(a);var b=0;if(this.model.get("industry_id")){b=this.model.get("industry_id")}else{if(this.model.get("owner")){b=this.model.get("owner").industry_id}}this.$("#event-description").val(this.model.get("description"));this.$("#event-industry-id").val(b);this.$("#event-tags-list").val(this.model.get("tag_list"));this.$("#event-hashtags-list").val(this.model.get("hashtag_list"));this.$("#event-website").val(this.model.get("website"));this.$("#event-registration-required").prop("checked",this.model.get("registration_required"))},displayValidationErrors:function(b){var a=this;_.each(b,function(e,c){var d=_.first(e);var f=a.$("#event-"+c.replace(/_/gi,"-"));if(c=="tag_list"){f=a.$("#event-tags-list")}f.parent().append('<div class="validation-error">'+d+"</div>")})},propagateInputsToModel:function(){this.model.set({description:this.$("#event-description").val()});this.model.set({industry_id:this.$("#event-industry-id").val()});this.model.set({hashtag_list:this.$("#event-hashtags-list").val()});this.model.set({tag_list:this.$("#event-tags-list").val()});this.model.set({website:this.$("#event-website").val()});this.model.set({registration_required:this.$("#event-registration-required").prop("checked")})}});var EventView=Backbone.View.extend({template:JST.event,tagName:"li",className:"event-template",events:{"click a.rsvp":"rsvpToEvent","click a.title":"showEvent"},initialize:function(){_.bindAll(this,"render","showEvent","rsvpToEvent");this.model.bind("change",this.render)},showEvent:function(){Router.send(Router.routes.EventDetailPage,{event:this.model.id})},rsvpToEvent:function(){this.model.rsvp()},render:function(){$(this.el).html(this.template(this.model.toJSON()));return this}});var EymlListView=ShowMoreListView.extend({template:JST.list,emptyListTemplate:JST.emptyEymlList,itemViewClass:EventItemView.extend({template:JST.eymlItem}),initialize:function(){ShowMoreListView.prototype.initialize.call(this);this.collection=new EymlCollection();this.installCollectionBindings();this.collection.fetch()},collectionWasReset:function(){ShowMoreListView.prototype.collectionWasReset.call(this);var a=this.collection.industry_id;if(a){$("#browse-my-industry").html('<a href="#">Browse '+this.collection.industry_name+" events &raquo;</a>");$("#browse-my-industry a").click(function(){Router.send(Router.routes.SearchPage,{ftype:"industry",facets:JSON.stringify([a])});return false})}return this}});var FacetItemView=Backbone.View.extend({template:JST["seeAllPeoplePage/facetItem"],tagName:"div",className:"facet visible-facet",parentView:null,events:{"click .val":"toggleFacet","click .ct":"toggleFacet"},initialize:function(a){this.parentView=a.parent;_.bindAll(this,"render","toggleOpacity","toggleFacet");this.model.bind("change:selected",this.toggleOpacity);this.render();this.delegateEvents()},render:function(){$(this.el).html(this.template(this.model.toJSON()));return this},toggleOpacity:function(){switch(this.model.get("selected")){case 0:$(this.el).removeClass("selected-facet");$(this.el).removeClass("transparent-facet").addClass("opaque-facet");break;case 1:$(this.el).removeClass("facet").addClass("selected-facet").addClass("facet");$(this.el).removeClass("transparent-facet").addClass("opaque-facet");break;case 2:$(this.el).removeClass("selected-facet");$(this.el).removeClass("opaque-facet").addClass("transparent-facet");break;default:$(this.el).removeClass("selected-facet");$(this.el).removeClass("transparent-facet").addClass("opaque-facet")}},toggleFacet:function(){var b=this.model.get("selected");if(b&&b==1){this.model.collection.deselectItem(this.model)}else{this.model.collection.selectItem(this.model)}var a=$(this.el).parent().attr("class").split("-")[0];this.parentView.raiseFacetClickBeacon(a,this.model.get("id"))}});var LandingPageView=Backbone.View.extend({template:JST.landingPage,searchBoxView:null,createBannerView:null,initialize:function(){this.el=$("#page-content");_.bindAll(this,"render");this.render();this.searchBoxView=new LandingSearchBoxView({parent:"home"});this.createBannerView=new CreateBannerView();OS.resize()},render:function(){pageView.hideSpinner();$(this.el).append(this.template());new MyEventsListView({el:this.$("#my-events-module .show-more-list-view")});new EymlListView({el:this.$("#eyml-module .show-more-list-view")});return this}});var LinkedinHomePageView=ShowMoreListView.extend({template:JST.linkedinHome,emptyListTemplate:JST.emptyEymlList,itemViewClass:EventItemView.extend({template:JST.eymlItem}),initialize:function(){$("body").append("<div id='linkedin-home'></div>");this.el=$("#linkedin-home");$("#opensocial-container").css({"min-height":"0px !important"});$("#opensocial-container").hide();$(".temp").hide();pageView.hideSpinner();ShowMoreListView.prototype.initialize.call(this);this.collection=new LinkedinHomeEymlCollection();this.installCollectionBindings();this.collection.fetch()},collectionWasReset:function(){ShowMoreListView.prototype.collectionWasReset.call(this);$(".home-link a").click(function(){Router.send(Router.routes.HomePage,{});return false});return this}});var MyEventsListView=ShowMoreListView.extend({template:JST.showMoreList,emptyListTemplate:JST.emptyMyEventsList,itemViewClass:EventItemView.extend({template:JST.myEvent}),initialize:function(){ShowMoreListView.prototype.initialize.call(this);this.collection=new MyEventsCollection();this.installCollectionBindings();this.collection.fetch()},emptyListRendered:function(){this.$(".empty-list a").click(function(){Router.send(Router.routes.SearchPage,{});return false})}});var PaginationView=Backbone.View.extend({template:JST.pagination,search:null,events:{"click .page":"navigateToNextPage"},initialize:function(a){this.el=$("#pages");_.bindAll(this,"render","morphModel","navigateToNextPage");this.delegateEvents()},render:function(b){this.model=b;this.model.current_page=Math.floor(b.get("start")/10)+1;this.model.total_pages=Math.floor(b.get("total")/10)+((Math.floor(b.get("total")%10)>0)?1:0);this.morphModel();$(this.el).html(this.template(this.model));var a=this;$(this.el).find(".page").each(function(){if(parseInt($(this).html(),10)==a.model.current_page){$(this).children().remove();$(this).html("<strong>"+a.model.current_page+"</strong>");$(this).removeClass("page").addClass("selected-page")}});OS.resize();return this},navigateToNextPage:function(b){var a=0;if($(b.target).html().indexOf("Next")!=-1){a=this.model.current_page+1}else{if($(b.target).html().indexOf("Previous")!=-1){a=this.model.current_page-1}else{a=parseInt($(b.target).html(),10)}}this.model.setPageAndFetch(a);return false},morphModel:function(){var b=0;var a=0;if(this.model.current_page<10){b=1;a=10}else{if(this.model.current_page>=10){b=this.model.current_page-5;a=this.model.current_page+4}}if(this.model.total_pages<a){a=this.model.total_pages}if(this.model.current_page==this.model.total_pages&&this.model.total_pages>10){b=this.model.current_page-9;a=this.model.current_page}if(this.model.current_page!==1){this.model.previousLink=true}else{this.model.previousLink=false}if(this.model.total_pages!==this.model.current_page){this.model.nextLink=true}else{this.model.nextLink=false}this.model.pages=_.range(b,a+1)}});var ProfilePageView=ShowMoreListView.extend({template:JST.profilePage,emptyListTemplate:JST.emptyProfileView,itemViewClass:EventItemView.extend({template:JST.myEventProfile}),initialize:function(){$("body").append("<div id='profile'></div>");this.el=$("#profile");$("#opensocial-container").css({"min-height":"0px !important"});$("#opensocial-container").hide();$(".temp").hide();pageView.hideSpinner();ShowMoreListView.prototype.initialize.call(this);this.collection=new YourEventsCollection();this.installCollectionBindings();this.collection.fetch()},collectionWasReset:function(){ShowMoreListView.prototype.collectionWasReset.call(this);$(".home-link a").click(function(){Router.send(Router.routes.HomePage,{});return false});return this}});var RequestMeetingView=Backbone.View.extend({template:JST.requestMeeting,dialog:null,initialize:function(){this.el=$("#wrapper");_.bindAll(this,"render","renderLiDialog","sendMessage","postMessage");this.render();OS.resize()},render:function(){$(this.el).html(this.template(this.model));this.renderLiDialog();OS.resize()},renderLiDialog:function(){this.dialog=LI.Dialog();var a=this;this.dialog.closeEvent.subscribe(function(){a.dialog.close();a.dialog=null;$(a.el).html("");a=null});this.dialog.submitEvent.subscribe(function(){a.sendMessage()});this.dialog.open(window.event,{name:"request-meeting-dialog",type:"task-modeless",width:500,className:"request-meeting",content:{node:"wrapper-main",title:"Request Meeting"}});$("#wrapper-main").show()},sendMessage:function(){this.postMessage();return false},postMessage:function(){var b={};b.subject=$("#wrapper-main").find("#post_subject").val();b.message=$("#wrapper-main").find("#post_message").val();b.toInfo=this.model.id;b.eventId=this.model.eventId;b.url="/users/"+this.model.id+"/meetings";var a=this;Backbone.sync("create",b,{success:function(d){console.log(d);$("#wrapper-main").find("#message-error").html("");$("#wrapper-main").find("#subject-error").html("");if(d.length>=1){$("#wrapper-main").find("#"+d[0].where+"-error").html(d[0].text)}else{var c={name:"request-meeting-dialog",type:"task-modeless",width:500,className:"request-meeting",content:{node:"wrapper-success",title:"Request Meeting"}};a.dialog.swap(c);$("#wrapper-main").hide();$("#wrapper-success").show()}},error:function(c){}});return false}});var LandingSearchBoxView=Backbone.View.extend({events:{"keyup #query":"checkForSearch","click #search-button-home":"searchEvents"},initialize:function(a){this.template=JST["searchBox-"+a.parent];this.el=$("#search-box-container");this.delegateEvents();_.bindAll(this,"render","checkForSearch","searchEvents");this.render()},render:function(){$(this.el).html(this.template());return this},checkForSearch:function(a){if(a.keyCode==13){this.searchEvents();return false}},searchEvents:function(){var a=$(this.el).find("#query").val();Tracker.trackClick("events_home_search_jsbeacon",a);Router.send(Router.routes.SearchPage,{q:a})}});var landingSearchBoxView;var EventSummaryView=Backbone.View.extend({template:JST["searchPage/eventSummary"],eventId:null,eventSearchModel:null,events:{"click #detail-page-link":"navigateToDetail","click #see-more":"navigateToDetail","click .nav-to-sap":"navigateToSap","click .follow-hover-div":"followEvent","click #detail-page":"navigateToDetail"},initialize:function(a){_.bindAll(this,"render","navigateToDetail","navigateToSap","showFollowDiv","followEvent","showSpinner","startFollowing");this.eventSearchModel=a.eventSearchModel;this.render();this.delegateEvents();this.showFollowDiv()},render:function(){$(this.el).html(this.template(this.model.toJSON()));$(this.el).find(".follow-hover-div").hide();OS.resize();return this},navigateToDetail:function(){var a=this.eventSearchModel.query;if(a.length==0){a=" "}Tracker.trackClick("events_search_detail_jsbeacon",this.model.get("id"));Router.send(Router.routes.EventDetailPage,{event:this.model.get("id"),breadCrumbData:a});return false},navigateToSap:function(){var a=this.eventSearchModel.query;if(a.length==0){a=" "}Tracker.trackClick("events_search_sap_jsbeacon",this.model.get("id"));Router.send(Router.routes.SeeAllPeoplePage,{event:this.model.get("id"),breadCrumbData:a});return false},showFollowDiv:function(){$(this.el).hover(function(){$(this).find(".follow-hover-div").show()},function(){$(this).find(".follow-hover-div").hide()})},followEvent:function(){Tracker.trackClick("events_search_followevent_jsbeacon",this.model.get("id"));this.showSpinner();this.startFollowing()},showSpinner:function(){var a=$(this.el).find(".follow-hover-div");a.removeClass("follow-hover-div").addClass("status-there-div");a.html("").show();var b=new Spinner(VerySmallSpinnerOpts).spin();a.append("<div class='spinner'></div>");a.find(".spinner").append(b.el)},startFollowing:function(){var a=this;Backbone.sync("update",{url:"/events/"+a.model.get("id")+"/rsvps/"+a.model.get("viewer_rsvp").user_id,role:"follower"},{success:function(){$(a.el).find(".status-there-div").html("Following")},error:function(){}})}});Search.FacetsView=Backbone.View.extend({template:JST["searchPage/facets"],facetsCollection:[],preSelectedFacets:null,events:{"click .show-more":"showMore"},initialize:function(a){this.el=$("#search-page .sap-facets .content");this.preSelectedFacets=a.preSelectedFacets;_.bindAll(this,"updateFacets","render","renderFacet","updateFacetsSelected","showSpinners","showMore","raiseFacetClickBeacon");this.delegateEvents()},updateFacets:function(d,c){var a=this;var b=[];_.each(d,function(g){var f=_.detect(a.facetsCollection,function(h){return(h.type==g.type)});if(f!=null){f.items=g.items;f.resetItems(c)}else{var e={type:g.type,parent:a,items:g.items,pxWidth:48};if(a.preSelectedFacets&&a.preSelectedFacets[g.type]){e.preSelectedIds=a.preSelectedFacets[g.type]}b.push(new Search.FacetItemsCollection([],e))}});a.facetsCollection=_.union(a.facetsCollection,b);this.render();return},render:function(b){var a=this;$(a.el).empty();_.each(this.facetsCollection,function(c){if(c.length!=0){a.renderFacet(c)}})},renderFacet:function(b){var a=this;var c=a.template({type:b.type,hasMore:b.hasMore});$(a.el).append($(c));_.each(b.models,function(e){var d=new FacetItemView({model:e,parent:a});$(a.el).find("."+b.type+"-items").append(d.render().el);d.toggleOpacity()})},updateFacetsSelected:function(){var a={};_.each(this.facetsCollection,function(b){var d={};var c=[];if(b.selectedItems&&b.selectedItems.length>0){_.each(b.selectedItems,function(e){c.push(e.id)});a[b.type]=c}});this.model.setFacetsAndFetch(a);this.showSpinners()},showSpinners:function(){var a=$(this.el).find(".facet-type");_.each(a,function(f){$(f).css({opacity:0.3});$(f).parent().append("<div id='spinner-"+f.id+"' ></div>");var c=$(f).offset().left+$(f).width()/2-20;var d=$(f).offset().top+$(f).height()/2;var b=$("#spinner-"+f.id);var e=new Spinner(VerySmallSpinnerOpts).spin();b.css({position:"absolute",top:d,left:c}).html(e.el)})},showMore:function(c){var b=$(c.target).parent().parent().find(".type").html();var a=this;_.each(this.facetsCollection,function(e){if(e.type===b){var d=e.showMore();$(c.target).toggle(d)}});this.render();OS.resize();return false},raiseFacetClickBeacon:function(a,c){var b="events_search_facet_"+a+"_jsbeacon";Tracker.trackClick(b,c);return false}});Search.SearchBoxView=Backbone.View.extend({template:JST["searchPage/searchBox"],events:{"click #query":"checkForSearch","keyup #query":"checkForSearch","click #search-button":"searchEvents","onBlur #search-box:input":"doThis","onFocus #search-box:input":"doThis"},initialize:function(){this.el=$("#search-box-container");_.bindAll(this,"render","checkForSearch","searchEvents","updateQuery","toggleText","doThis");this.delegateEvents();this.render();this.doThis()},render:function(){$(this.el).html(this.template());$(this.el).find("#query").val(this.model.query).click();this.toggleText();this.searchEvents();return this},checkForSearch:function(b){var a=$(b.target).val();if(b.keyCode==13&&a.length>0){this.searchEvents();return false}},searchEvents:function(){var a=$(this.el).find("#query").val();this.model.setQueryAndFetch(a)},updateQuery:function(a){$(this.el).find("#query").val(a)},toggleText:function(){var a=$(this.el).find("#query").val();if((a.length==0)){$(this.el).find(".g-text").show()}else{$(this.el).find(".g-text").hide()}},doThis:function(){var a=this;$(this.el).find("#query").blur(function(){if($(a.el).find("#query").val().length==0){$(a.el).find(".g-text").show()}});$(this.el).find("#query").focus(function(){$(a.el).find(".g-text").hide()})}});var SearchPageView=Backbone.View.extend({template:JST["searchPage/searchPage"],searchResultsView:null,searchBoxView:null,paginationView:null,adsView:null,adsRendered:false,events:{"click #include-past-events-anchor":"togglePastEventSelection","change #include-past-events":"togglePastEventSelection","click #selection-holder":"showDropDown","click .search-relevancy":"searchByRelevancy","click .search-date":"searchByDate"},initialize:function(b){this.el=$("#page-content");_.bindAll(this,"render","renderResults","togglePastEventSelection","hideDropDownMenu","showDropDown");this.render();this.delegateEvents();this.model=new EventSearch();this.model.view=this;this.model.query=b.q;var a={};if(b.facets){a[b.ftype]=JSON.parse(b.facets);this.model.facets=a}this.facetsView=new Search.FacetsView({model:this.model,preSelectedFacets:a});this.searchResultsView=new Search.SearchResultsView({model:this.model,type:EventSummary,container:$(this.el).find(".right-section-large")});this.paginationView=new PaginationView();this.searchBoxView=new Search.SearchBoxView({model:this.model});OS.resize()},render:function(){pageView.hideSpinner();$(this.el).html(this.template());var b={list:[{title:"Events Home",link:true,page:Router.routes.HomePage,params:{}},{title:"Search Results",link:false}]};this.breadcrumbView=new BreadCrumbView(b);$(this.el).find(".past-event-checkbox").hide();this.hideDropDownMenu();var a=this;$(document).click(function(){a.hideDropDownMenu()});return this},showDropDown:function(a){a.stopPropagation();if($(this.el).find(".btn-drop").css("display")==="none"){if(this.model.sortBy==="relevance"){$(this.el).find(".btn-drop").html("<h2><span></span>Relevance</h2><li class='search-date'><span></span>Date</li>")}else{$(this.el).find(".btn-drop").html("<li class='search-relevancy'><span></span>Relevance</li><h2><span></span>Date</h2>")}var b=$(a.target).offset();$(this.el).find(".btn-drop").css("top",b.top+15);$(this.el).find(".btn-drop").css("left",b.left);$(this.el).find(".btn-drop").css("display","block")}else{$(this.el).find(".btn-drop").css("display","none")}return false},hideDropDownMenu:function(){$(this.el).find(".btn-drop").hide()},searchByRelevancy:function(){if(this.model.sortBy!=="relevance"){this.model.setSortByAndFetch("relevance")}this.hideDropDownMenu();return false},searchByDate:function(){if(this.model.sortBy!=="date"){this.model.setSortByAndFetch("date")}this.hideDropDownMenu();return false},renderResults:function(){var a=this.model.sortBy;a=a.charAt(0).toUpperCase()+a.slice(1);$(this.el).find("#selection-holder").html(a);$(this.el).find("#selection-holder").html();$(this.el).find("#page-stat").html("");$(this.el).find(".past-event-checkbox").show();$(this.el).find("#include-past-events").prop("checked",this.model.includePast);var e=this.model.get("start")+1;var b=this.model.get("start")+this.model.get("count");var c=this.model.get("total");this.facetsView.updateFacets(this.model.get("facets_info"),this.model.resetFacets);var d="";if(e==b==c){d="Showing "+e+" of "+b}else{d="Showing "+e+"-"+b+" of "+c}if(c>0){$(this.el).find("#page-stat").html(d)}this.searchResultsView.showResults(this.model.get("items"));if(this.model.get("total")>10){$(this.paginationView.el).show();this.paginationView.render(this.model)}else{$(this.paginationView.el).hide()}if(!this.adsRendered){this.adsRendered=true;this.adsView=new AdsView({page:"search"})}},togglePastEventSelection:function(e){if($(e.target).attr("id")=="include-past-events"){this.model.setPastEventFlagAndFetch(eval($(e.target).prop("checked")))}if($(e.target).attr("id")=="include-past-events-anchor"){var oldCheckboxState=eval($(this.el).find("#include-past-events").prop("checked"));$(this.el).find("#include-past-events").prop("checked",!oldCheckboxState);this.model.setPastEventFlagAndFetch(!oldCheckboxState)}Tracker.trackClick("events_search_facet_past_jsbeacon","");return false}});Search.SearchResultsView=ASearchResultsView.extend({pasteResults:function(){$(".right-section-large").show();$(this.el).html("").show();var a=this;if(this.searchResultsCollection.models.length!=0){_.each(this.searchResultsCollection.models,function(d){var c=new EventSummaryView({model:d,eventSearchModel:a.model});$(a.el).append(c.render().el)})}else{var b=JST["searchPage/noSearchResults"];$(this.el).html(b())}OS.resize();this.hideSpinner()}});Sap.FacetsView=Backbone.View.extend({template:JST["seeAllPeoplePage/facets"],facetsCollection:[],events:{"click .show-more":"showMore"},initialize:function(a){this.el=$("#see-all-people-page .sap-facets .content");_.bindAll(this,"updateFacets","render","renderFacet","updateFacetsSelected","showSpinners","showMore","raiseFacetClickBeacon");this.delegateEvents()},updateFacets:function(c){var b=this;var a=[];_.each(c,function(e){var d=_.detect(b.facetsCollection,function(f){return(f.type==e.type)});if(d!=null){d.items=e.items;d.resetItems()}else{a.push(new Sap.FacetItemsCollection([],{type:e.type,parent:b,items:e.items,pxWidth:48}))}});b.facetsCollection=_.union(b.facetsCollection,a);this.render();return},render:function(b){var a=this;$(a.el).empty();_.each(this.facetsCollection,function(c){a.renderFacet(c)})},renderFacet:function(a){var b=this;var c=b.template({type:a.type,hasMore:a.hasMore});$(b.el).append($(c));_.each(a.models,function(e){var d=new FacetItemView({model:e,parent:b});$(b.el).find("."+a.type+"-items").append(d.render().el);d.toggleOpacity()})},updateFacetsSelected:function(){var a={};_.each(this.facetsCollection,function(b){var d={};var c=[];if(b.selectedItems&&b.selectedItems.length>0){_.each(b.selectedItems,function(e){c=_.union(c,e.user_ids)});a[b.type]=c}});this.model.setFacetsAndFetch(a);this.showSpinners()},showSpinners:function(){var a=$(this.el).find(".facet-type");_.each(a,function(f){$(f).css({opacity:0.3});$(f).parent().append("<div id='spinner-"+f.id+"' ></div>");var c=$(f).offset().left+$(f).width()/2-20;var d=$(f).offset().top+$(f).height()/2;var b=$("#spinner-"+f.id);var e=new Spinner(VerySmallSpinnerOpts).spin();b.css({position:"absolute",top:d,left:c}).html(e.el)})},showMore:function(c){var b=$(c.target).parent().parent().find(".type").html();var a=this;_.each(this.facetsCollection,function(e){if(e.type===b){var d=e.showMore();$(c.target).toggle(d)}});this.render();OS.resize();return false},raiseFacetClickBeacon:function(a,c){var b="events_sap_facet_"+a+"_jsbeacon";Tracker.trackClick(b,c);return false}});Sap.SearchResultsView=ASearchResultsView.extend({pasteResults:function(){$(".right-section-large").show();$(this.el).html("").show();var a=this;_.each(this.searchResultsCollection.models,function(c){var b=new UserView({model:c});$(a.el).append(b.render().el)});OS.resize();this.hideSpinner()}});var SeeAllPeoplePageView=Backbone.View.extend({template:JST["seeAllPeoplePage/seeAllPeoplePage"],searchResultsView:null,searchBoxView:null,paginationView:null,breadCrumbData:null,adView:null,adRendered:false,sortOrders:[["date","Date Responded"],["name","Name"]],events:{"click .search-sort .toggle a":"toggleSearchSort","click .search-sort .toggle .current":"toggleSearchSort","click .sort-drop-down ul li a":"setSearchOrder"},initialize:function(b){this.breadCrumbData=b.breadCrumbData;this.el=$("#page-content");_.bindAll(this,"updateAttendeesAndRender","renderResults","hideDropDownMenu");this.parentModel=new Event({id:b.event});this.parentModel.fields="title,ends_at_ts,starts_at_ts,venue,geo_region_code,industry_id";this.parentModel.include="viewer_rsvp,rsvps(role:attendee,sort:date,count:10,facets_info:true)";this.parentModel.bind("change",this.updateAttendeesAndRender);var a=this;$(document).click(function(){a.hideDropDownMenu()});this.parentModel.fetch()},hideDropDownMenu:function(){$(".sort-drop-down").hide()},updateAttendeesAndRender:function(){pageView.hideSpinner();$(this.el).html(this.template(this.parentModel.toJSON()));var a=this.parentModel.toJSON();if(this.breadCrumbData){var b={list:[{title:"Events Home",link:true,page:Router.routes.HomePage,params:{}},{title:"Search Results",link:true,page:Router.routes.SearchPage,params:{q:this.breadCrumbData}},{title:a.title,link:true,page:Router.routes.EventDetailPage,params:{event:a.id,query:this.breadCrumbData}},{title:"Attendees",link:false}]};this.breadCrumbView=new BreadCrumbView(b)}else{var b={list:[{title:"Events Home",link:true,page:Router.routes.HomePage,params:{}},{title:a.title,link:true,page:Router.routes.EventDetailPage,params:{event:a.id}},{title:"Attendees",link:false}]};this.breadCrumbView=new BreadCrumbView(b)}var c=_.map(this.parentModel.rosterPage.get("items"),function(d){return d.user});this.model=new AttendeeSearch({usersCollection:new UsersCollection(c)});this.model.extractOtherProperties(a);this.model.view=this;this.model.get("usersCollection").bind("reset",this.renderResults);this.facetsView=new Sap.FacetsView({model:this.model});this.searchResultsView=new Sap.SearchResultsView({model:this.model,type:AttendeeSearch,container:$(this.el).find(".right-section-large")});this.paginationView=new PaginationView();this.renderResults();if(!this.adRendered){this.adRendered=true;this.adView=new AdsView({page:"sap",model:this.parentModel})}},renderResults:function(){var h=this.model.get("start")+1;var b=this.model.get("start")+this.model.get("count");var d=this.model.get("total");$(this.el).find("#page-stat").html("Showing "+this.model.get("range")+" of "+this.model.get("total"));this.facetsView.updateFacets(this.model.currentFacets);this.searchResultsView.showResults(this.model.get("usersCollection"));if(this.model.get("total")>10){$(this.paginationView.el).show();this.paginationView.render(this.model)}else{$(this.paginationView.el).hide()}var a=$(this.el).find(".search-sort");var c=this.model.currentSelection.sort;var g=_.detect(this.sortOrders,function(i){return i[0]===c})[1];a.find(".current a").html(g);var f=$(this.el).find(".sort-drop-down ul");f.html("");var e=_.each(this.sortOrders,function(j){var i=$('<li><a data-sort-key="'+j[0]+'">'+j[1]+"</a></li>");if(j[0]===c){i.addClass("selected")}f.append(i)});this.delegateEvents();OS.resize()},toggleSearchSort:function(b){b.preventDefault();b.stopPropagation();var a=null;if($(b.target).hasClass("current")){a=$(b.target).children().first().position()}else{a=$(b.target).position()}$(this.el).find(".sort-drop-down").toggle().css({left:a.left,top:a.top+18});return false},setSearchOrder:function(b){b.preventDefault();$(this.el).find(".sort-drop-down").toggle();var a=$(b.target).attr("data-sort-key");this.model.changeSort(a)}});var UserView=Backbone.View.extend({template:JST.user,className:"user-summary",render:function(){$(this.el).html(this.template(this.model.toJSON()));return this}});var StaticErrorPageView=Backbone.View.extend({template:JST.staticErrorPage,max:100,initialize:function(a){this.el=$("#opensocial-container");this.errorParams=a;_.bindAll(this,"render");this.render();OS.resize()},render:function(){pageView.hideSpinner();var a=eventsAssetUrl+"/images/events_Logo.png";$("#opensocial-container div").hide();$(this.el).find("#static-error").show();$("#opensocial-container").addClass("error-background");$(this.el).find("#static-error").html(this.template({logo:a}));return this}});var StaticLinkedinHomePageView=ShowMoreListView.extend({template:JST.staticLinkedinHome,events:{"keyup #query":"checkForSearch","click #nav-to-home":"navToHome","click #nav-to-search":"navToSearch"},initialize:function(){$("body").append("<div id='static-linkedin-home'></div>");this.el=$("#static-linkedin-home");$("#opensocial-container").css({"min-height":"0px !important"});$("#opensocial-container").hide();$(".temp").hide();_.bindAll(this,"render","navToHome","navToSearch","checkForSearch");pageView.hideSpinner();this.delegateEvents();this.render();OS.resize()},render:function(){$(this.el).html(this.template())},checkForSearch:function(a){if(a.keyCode==13){this.navToSearch();return false}},navToSearch:function(){Tracker.trackClick("events_hpsearch_jsbeacon","");var a=$(this.el).find("#query").val();Router.send(Router.routes.SearchPage,{q:a});return false},navToHome:function(){Tracker.trackClick("events_hphome_jsbeacon","");Router.send(Router.routes.HomePage,{});return false}});Handlebars.registerHelper("eventAttendeeThumbnails",function(){if(this.rsvps&&this.rsvps.count>0){var b=JST.userThumbnail;var a=_.map(this.rsvps.items,function(c){return b(c.user)});return new Handlebars.SafeString(a.join("\n"))}});Handlebars.registerHelper("eventOtherAttendeesSummary",function(){if(this.rsvps&&this.rsvps.count>0){if(this.rsvps.total>this.rsvps.count){return new Handlebars.SafeString('and <a class="nav-to-sap" href="#">'+(this.rsvps.total-this.rsvps.count)+" other people</a> are attending.")}else{if(this.rsvps.count>1){return"are attending."}else{return"is attending."}}}});Handlebars.registerHelper("eventRecentUpdatesSummary",function(){if(this.recent_update_count&&this.recent_update_count>0){return new Handlebars.SafeString(['<a class="nav-to-detail" href="#">',this.recent_update_count,this.recent_update_count>1?"updates":"update","this week</a>"].join(" "))}});Handlebars.registerHelper("eventViewerRelationship",function(){if(this.viewer_rsvp){if(this.owner&&this.viewer_rsvp.user_id==this.owner.id){return"Organizing"}else{return{attendee:"Attending",follower:"Following"}[this.viewer_rsvp.role]}}});Handlebars.registerHelper("userThumbnailUrl",function(){return this.thumbnail_url||(eventsAssetUrl+"/images/icon_no_photo_no_border_60x60.png")});Handlebars.registerHelper("userSummary",function(){return[this.name,this.about_me].join(", ")});var Router={define:function(a,b){return{key:a,fn:b}},routes:{HomePage:{urlParam:"home",fn:LandingPageView,pageKey:"events_home_jsbeacon"},SearchPage:{urlParam:"search",fn:SearchPageView,pageKey:"events_search_jsbeacon"},EventDetailPage:{urlParam:"event",fn:EventDetailPageView,pageKey:"events_detail_jsbeacon",trackKey:"event"},SeeAllPeoplePage:{urlParam:"sap",fn:SeeAllPeoplePageView,pageKey:"events_sap_jsbeacon"},CreateEventStep1Page:{urlParam:"step1",fn:CreateEventStep1PageView,pageKey:"events_createrequired_jsbeacon"},CreateEventStep2Page:{urlParam:"step2",fn:CreateEventStep2PageView,pageKey:"events_createoptional_jsbeacon"},CreateEventStep3Page:{urlParam:"step3",fn:CreateEventStep3PageView,pageKey:"events_createsharing_jsbeacon"},EditEventPage:{urlParam:"edit",fn:EditEventPageView,pageKey:"events_home_jsbeacon"},StaticErrorPage:{urlParam:"error",fn:StaticErrorPageView},ProfilePage:{urlParam:"profile",fn:ProfilePageView},LinkedinHomePage:{urlParam:"linkedinhome",fn:StaticLinkedinHomePageView}},receive:function(){var a=gadgets.views.getCurrentView().name_;pageView=new PageView();pageView.showSpinner();banner=new BannerView();var e=gadgets.views.getParams();for(var c in e){e[c]=Router.htmlEncode(e[c])}if(e.cd){Router.processBannerCode(e.cd)}if(!e.page){e.page="home"}if(a=="profile"){e.page="profile"}if(a=="home"){e.page="linkedinhome"}for(var c in Router.routes){var d=Router.routes[c];if(d.urlParam===e.page){if(d.urlParam=="event"){eventDetailPageView=new d.fn(e)}else{new d.fn(e)}if(d.pageKey){if(d.trackKey){var b=e[d.trackKey];Tracker.trackPage(d.pageKey,b)}else{Tracker.trackPage(d.pageKey)}}}}if(a==="canvas"){setTimeout(function(){Router.refreshPage()},3000000)}},send:function(a,b){b.page=a.urlParam;OS.navigateToOwnerlessCanvasView(b)},refreshPage:function(){var a=gadgets.views.getParams();window.parent.location=Router.generateUrl("canvas",a)},generateUrl:function(c,e){var b=new gadgets.views.View(c);var a={params:e,owner:linkedin.IdSpec.PersonId.IMPLICIT};var d=b.bind(a);return d},htmlEncode:function(a){if(a==null){return null}return a.toString().replace(/(.)/g,function(b){if(b=="<"){return"&lt;"}else{if(b==">"){return"&gt;"}else{if(b=="&"){return"&amp;"}else{if(b=='"'){return"&quot;"}else{if(b.charCodeAt(0)<127){return b}return"&#x"+escape(b).toLowerCase().replace("%","")+";"}}}}})},processBannerCode:function(b){try{var c=parseInt(b);switch(c){case 1:banner.publish("error","The event you are looking for could not be found. It may have been deleted by the organizer.");break;case 2:banner.publish("info","Your event has been deleted.");break}}catch(a){return}}};function startApp(){$("a.ext").live("click",function(c){var b=$(this);var a=b.attr("href");Tracker.trackClick("events_detail_link_jsbeacon",a);if(b.attr("rel")==="nofollow"){window.open(a,"_blank")}else{window.top.location.href=a}return false});Router.receive()};